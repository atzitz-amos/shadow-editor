(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class c{static createElement(e,t){function i(u,p,g){switch(p){case".":u.classList.add(g);break;case"#":u.id=g;break}}let s="",o=null,h=null;for(let u of e)[".","#"].includes(u)?(o?i(o,h,s):o=document.createElement(s),h=u,s=""):s+=u;return i(o,h,s),t&&t.appendChild(o),o}static px(e){return`${e}px`}}class _{view;element}class Ee extends _{visualLineCount;lines;edgelines;constructor(e,t){super(),this.view=e,this.element=c.createElement("div.editor-layer.layer-inner",t)}init(){this.visualLineCount=this.view.visualLineCount,this.lines=[];let e=c.createElement("div.editor-line.editor-line-edge",this.element);for(let i=0;i<this.visualLineCount;i++)this.lines.push(c.createElement("div.editor-line.line-"+i,this.element));let t=c.createElement("div.editor-line.editor-line-edge",this.element);this.edgelines=[e,t]}destroy(){}render(){}update(){}renderLine(e,t){this.lines[e].innerHTML="",this.lines[e].append(...t)}renderEdgeLine(e,t){this.edgelines[e].innerHTML="",this.edgelines[e].append(...t)}}class ve extends _{_caret;_input;_blink;constructor(e,t){super(),this.view=e,this.element=c.createElement("div.editor-layer.layer-caret",t),this._caret=c.createElement("div.editor-caret#caret-0",this.element),this._input=c.createElement("input.editor-input",this.element),this._blink=setInterval(()=>this.blink(),750)}blinkReset(){this._caret.classList.remove("blink"),clearInterval(this._blink),this._blink=setInterval(this.blink.bind(this),750)}focus(){this._input.focus()}init(){}setupEventListeners(){this._input.addEventListener("input",e=>{this.view.editor.fire("onInput",e),this.blinkReset()}),this._input.addEventListener("keydown",e=>{this.view.editor.fire("onKeyDown",e)}),this._input.addEventListener("keyup",e=>{this.view.editor.fire("onKeyUp",e)}),this._input.addEventListener("focus",e=>{this.view.editor.fire("onFocus",e),this.blinkReset()}),this._input.addEventListener("blur",e=>{this.view.editor.fire("onBlur",e),this.blinkReset()})}destroy(){}render(){this.update()}update(){this.view.editor.caretModel.forEachCaret(e=>{let t=this.getCaretElement(e);t.style.top=c.px(e.position.toVisual().y),t.style.left=c.px(e.position.toVisual().x)})}getCaretElement(e){return this.element.querySelector(`#caret-${e.id}`)}blink(){this._caret.classList.toggle("blink")}}class xe{view;caret;selectionStartEl;selectionBodyEl;selectionEndEl;constructor(e,t){this.view=e.view,this.caret=t,this.selectionStartEl=c.createElement("div.editor-selection.selection-start",e.element),this.selectionBodyEl=c.createElement("div.editor-selection.selection-body",e.element),this.selectionEndEl=c.createElement("div.editor-selection.selection-end",e.element)}render(){this.selectionStartEl.style.display="none",this.selectionBodyEl.style.display="none",this.selectionEndEl.style.display="none";let e=this.caret.selectionModel;if(e.isSelectionActive&&e.start&&e.end){let t=e.start.toVisual(),i=e.end.toVisual(),s=t.x,o=t.y,h=i.x,u=i.y;o>u?([o,u]=[u,o],[s,h]=[h,s]):o===u&&s>h&&([s,h]=[h,s]);let p=(u-o)/this.view.getLineHeight();o===u?(this.selectionStartEl.style.display="block",this.selectionStartEl.style.left=c.px(s),this.selectionStartEl.style.top=c.px(o),this.selectionStartEl.style.width=c.px(h-s)):(this.selectionStartEl.style.display="block",this.selectionStartEl.style.left=c.px(s),this.selectionStartEl.style.top=c.px(o),this.selectionStartEl.style.width=c.px(this.view.getViewWidth()),p>1&&(this.selectionBodyEl.style.display="block",this.selectionBodyEl.style.top=c.px(o+this.view.getLineHeight()),this.selectionBodyEl.style.height=c.px((p-1)*this.view.getLineHeight())),this.selectionEndEl.style.display="block",this.selectionEndEl.style.top=c.px(u),this.selectionEndEl.style.width=c.px(h))}}}class ye extends _{selectionElements=new Map;constructor(e,t){super(),this.view=e,this.element=c.createElement("div.editor-layer.layer-selection",t)}init(){this.view.editor.caretModel.forEachCaret(e=>{this.selectionElements.set(e.id,new xe(this,e))})}destroy(){}render(){this.update()}update(){this.selectionElements.forEach(e=>e.render())}}class ke extends _{_activeLine;constructor(e,t){super(),this.view=e,this.element=c.createElement("div.editor-layer.layer-active-line",t),this._activeLine=c.createElement("div.editor-active-line",this.element)}init(){this.view.editor.properties}destroy(){}render(){this.update()}update(){let e=this.view.editor.caretModel.primary.position.toVisual().y;this._activeLine.style.top=c.px(e)}}class Le{layers_el;text;caret;selection;activeLine;constructor(e){this.layers_el=c.createElement("div.editor-layers",e.view),this.text=new Ee(e,this.layers_el),this.caret=new ve(e,this.layers_el),this.selection=new ye(e,this.layers_el),this.activeLine=new ke(e,this.layers_el)}init(){this.text.init(),this.caret.init(),this.selection.init(),this.activeLine.init()}setupEventListeners(){this.caret.setupEventListeners()}destroy(){this.text.destroy(),this.caret.destroy(),this.selection.destroy(),this.activeLine.destroy(),this.layers_el.remove()}render(){this.text.render(),this.caret.render(),this.selection.render(),this.activeLine.render()}update(){this.text.update(),this.caret.update(),this.selection.update(),this.activeLine.update()}}class Se{view;element;digits=1;lines=[];edgelines=[];constructor(e){this.view=e,this.element=c.createElement("div.editor-gutter",e.view)}init(){this.lines=[];let e=c.createElement("div.editor-gutter-line.editor-line-edge",this.element);for(let i=0;i<this.view.visualLineCount;i++)this.lines.push(c.createElement("div.editor-gutter-line.gutter-line-"+i,this.element));let t=c.createElement("div.editor-gutter-line.editor-line-edge",this.element);this.edgelines=[e,t]}initCSS(){this.update()}update(){this.element.style.setProperty("--editor-gutter-num-size",c.px(this.digits*this.view.getCharSize()))}destroy(){}renderLine(e,t){this.lines[e].innerHTML="",this.lines[e].append(...t)}renderEdgeLine(e,t){this.edgelines[e].innerHTML="",this.edgelines[e].append(...t)}}class he{onAttached(e,t){}onBlur(e,t){}onFocus(e,t){}onInput(e,t){}onKeyDown(e,t){}onKeyUp(e,t){}onMouseDown(e,t){}onMouseMove(e,t){}onMouseUp(e,t){}onRender(e){}onScroll(e,t){}}class be{onCaretRemove(e,t){}onCaretMove(e,t,i,s){}}class Ae{visualListeners=[];editorListeners=[];keybindingListeners=new Map;addVisualEventListener(e){this.visualListeners.push(e)}addEditorEventListener(e){this.editorListeners.push(e)}addKeybindingListener(e,t){this.keybindingListeners.set(e,t)}fireKeybinding(e,t){for(let[i,s]of this.keybindingListeners.entries())this.matches(i,e)&&s.apply(null,[t,e])}fire(e,...t){for(const i of this.visualListeners){const s=i[e];s&&s.apply(i,t)}for(const i of this.editorListeners){const s=i[e];s&&s.apply(i,t)}}matches(e,t){return t.key===e.key&&(e.ctrl?t.ctrlKey:!0)&&(e.alt?t.altKey:!0)&&(e.shift?t.shiftKey:!0)}}const Ce={view:{width:600,height:400,gutterWidth:60,lineHeight:25,caretHeight:20,fontSize:16,rootBgColor:"#1e1f24",rootBorderColor:"#93969f",gutterColor:"#93969f",caretColor:"#ffffff",selectionColor:"#214283",activeLineColor:"#2b2e38"}};class Re{view;scrollX;scrollY;constructor(e,t,i){this.view=e,this.scrollX=t,this.scrollY=i}get scrollYLines(){return Math.ceil(this.scrollY/this.view.getLineHeight())}set scrollYLines(e){this.scrollY=e*this.view.getLineHeight()}get scrollXChars(){return Math.ceil(this.scrollX/this.view.getCharSize())}set scrollXChars(e){this.scrollX=e*this.view.getCharSize()}get scrollYOffset(){return this.scrollY%this.view.getLineHeight()}get scrollXOffset(){return this.scrollX%this.view.getCharSize()}}function Te(r){let e=c.createElement("div.editor-sizer",r.view);return e.innerHTML="a",()=>e.getBoundingClientRect().width}class Pe{editor;view;scroll;gutter;layers;getCharSize;getLineHeight;getViewWidth;getViewHeight;visualLineCount;visualCharCount;constructor(e){this.editor=e,this.editor.addVisualEventListener(new class extends he{onBlur(t,i){t.root.classList.remove("focused")}onFocus(t,i){t.root.classList.add("focused")}onMouseDown(t,i){i.preventDefault(),t.view.focus()}onScroll(t,i){i.preventDefault();let s=i.deltaY;s!==0&&t.view.scrollBy(0,s),t.view.resetBlink()}}),this.editor.addEditorEventListener(new class extends be{onCaretMove(t,i,s,o){i.editor.view.scrollIntoView(o,1)}})}onAttached(e,t){this.view=c.createElement("div.editor-view",t),this.scroll=new Re(this,0,0),this.gutter=new Se(this),this.layers=new Le(this),this.initCSS(),this.setupEventListeners(),this.gutter.init(),this.layers.init(),this.render()}setCSSProperties(e,t){for(const[i,s]of Object.entries(t))e.style.setProperty(i,s)}focus(){this.layers.caret.focus()}scrollBy(e,t){let i=this.scroll.scrollY+t;i<0?this.scroll.scrollY=0:i>(this.editor.getLineCount()-this.visualLineCount+2)*this.getLineHeight()?this.scroll.scrollY=Math.max(0,(this.editor.getLineCount()-this.visualLineCount+2)*this.getLineHeight()):this.scroll.scrollY=i}scrollIntoView(e,t){let i=this.scrollIntoViewAlong(e.y,this.scroll.scrollYLines,this.scroll.scrollYLines+this.visualLineCount-1);i!==null&&(this.scroll.scrollY=i*this.getLineHeight())}animateScroll(e){}getRelativePos(e){let t=e.clientX-this.layers.layers_el.getBoundingClientRect().left,i=e.clientY-this.layers.layers_el.getBoundingClientRect().top;return[t,i]}render(){let e=this.scroll.scrollYLines,t=this.scroll.scrollYOffset,i=this.editor.take(this.visualLineCount,e);for(let s=0;s<this.visualLineCount;s++)this.layers.text.renderLine(s,i[s].content),this.gutter.renderLine(s,i[s].gutter);if(this.gutter.digits=Math.floor(Math.log10(this.editor.getLineCount()))+1,t){if(e>0){let s=this.editor.getLine(e-1);this.layers.text.renderEdgeLine(0,s.content),this.gutter.renderEdgeLine(0,s.gutter)}if(e+this.visualLineCount<this.editor.getLineCount()){let s=this.editor.getLine(e+this.visualLineCount);this.layers.text.renderEdgeLine(1,s.content),this.gutter.renderEdgeLine(1,s.gutter)}}this.setCSSProperties(this.view,{"--editor-scroll-offsetY":c.px(t||this.getLineHeight())}),this.update()}update(){this.gutter.update(),this.layers.update()}destroy(){this.gutter.destroy(),this.layers.destroy(),this.view.remove()}updateTextLayer(){this.layers.text.update(),this.layers.activeLine.update()}updateCaret(){this.layers.caret.update()}updateSelection(){this.layers.selection.update()}updateActiveLine(){this.layers.activeLine.update()}updateGutter(){this.gutter.update()}resetBlink(){this.layers.caret.blinkReset()}offScreen(e){let t=e.toVisual();return t.x<0||t.x>=this.getViewWidth()||t.y<0||t.y>=this.getViewHeight()}scrollIntoViewAlong(e,t,i){if(e>t&&e<i)return null;if(e<=t)return Math.max(0,e-2);{let s=i-t;return e+1>=this.editor.getLineCount()?Math.max(0,this.editor.getLineCount()-s):Math.max(0,e-s)}}setupEventListeners(){this.view.addEventListener("mousedown",e=>this.editor.fire("onMouseDown",e)),this.view.addEventListener("mouseup",e=>this.editor.fire("onMouseUp",e)),this.view.addEventListener("mousemove",e=>this.editor.fire("onMouseMove",e)),this.view.addEventListener("wheel",e=>this.editor.fire("onScroll",e)),this.view.addEventListener("contextmenu",e=>e.preventDefault()),this.layers.setupEventListeners()}initCSS(){const e=this.editor.properties.view||(this.editor.properties.view={});function t(i){return e[i]||(e[i]=Ce.view[i])}this.setCSSProperties(this.editor.root,{"--editor-width":c.px(t("width")),"--editor-height":c.px(t("height")),"--editor-root-bg":t("rootBgColor"),"--editor-root-border-color":t("rootBorderColor"),"--editor-font-size":c.px(t("fontSize")),"--editor-line-height":c.px(t("lineHeight")),"--editor-gutter-width":c.px(t("gutterWidth")),"--editor-caret-height":c.px(t("caretHeight")),"--editor-gutter-color":t("gutterColor"),"--editor-caret-color":t("caretColor"),"--editor-selection-color":t("selectionColor"),"--editor-active-line-color":t("activeLineColor")}),this.getCharSize=Te(this),this.getLineHeight=()=>e.lineHeight,this.getViewWidth=()=>e.width,this.getViewHeight=()=>e.height,this.visualLineCount=Math.floor(e.height/this.getLineHeight()),this.visualCharCount=Math.floor(e.width/this.getCharSize()),this.setCSSProperties(this.view,{"--editor-scroll-offsetY":c.px(this.getLineHeight())}),this.gutter.initCSS()}}class Me{name;files;constructor(e,t){this.name=e,this.files=t||[]}static singleFileProject(e){return new this("unnamed-project",[e])}addFile(e){for(let t of this.files)if(t.path===e.path)return;this.files.push(e)}}class Be{name;path;type;constructor(e,t,i){this.name=e||"temp-file",this.path=t?t+"/"+this.name:"",this.type=i||"js"}read(){return this.path==="",""}}class Fe{editor;plugins;lexerProviderMap=new Map;highlighterProviderMap=new Map;parserProviderMap=new Map;constructor(e){this.editor=e,this.plugins={}}register(e){this.plugins[e.name]=e,e.onRegistered(this.editor,this)}registerFileTypeAssociation(e,t,i,s){this.lexerProviderMap.set(e,t),i&&this.highlighterProviderMap.set(e,i),s&&this.parserProviderMap.set(e,s)}getLexerForFileType(e){const t=this.lexerProviderMap.get(e);if(t)return t()}getHighlighterForFileType(e){const t=this.highlighterProviderMap.get(e);if(t)return t()}getParserForFileType(e){const t=this.parserProviderMap.get(e);if(t)return t()}}class T{weight;left;right;value;constructor(e=null,t=null,i=null){this.value=e,this.left=t,this.right=i,e!==null?this.weight=e.length:t?this.weight=t.getTotalWeight():this.weight=0}isLeaf(){return this.left===null&&this.right===null}getTotalWeight(){return this.isLeaf()?this.value?this.value.length:0:(this.left?this.left.getTotalWeight():0)+(this.right?this.right.getTotalWeight():0)}}class B{root;constructor(e=""){this.root=new T(e)}concat(e){this.root=new T(null,this.root,e.root),this.root.weight=this.root.left.getTotalWeight()}index(e){return this._index(this.root,e)}toString(){return this._toString(this.root)}split(e){const[t,i]=this._split(this.root,e),s=new B;s.root=t;const o=new B;return o.root=i,[s,o]}insert(e,t){const[i,s]=this.split(e),o=new B(t);i.concat(o),i.concat(s),this.root=i.root}delete(e,t){const[i,s]=this.split(e),[o,h]=s.split(t);return i.concat(h),this.root=i.root,o.toString()}length(){return this.root.getTotalWeight()}substring(e,t){if(t===void 0&&(t=this.length()),e<0||t>this.length()||e>t)throw new Error("Invalid range for substring");return this._toString(this.root).substring(e,t)}getTextInRange(e){return this.substring(e.begin,e.end)}_index(e,t){if(e.isLeaf()){if(!e.value||t>=e.value.length)throw new Error("Index out of bounds");return e.value[t]}return t<e.weight?this._index(e.left,t):this._index(e.right,t-e.weight)}_toString(e){return e.isLeaf()?e.value??"":this._toString(e.left)+this._toString(e.right)}_split(e,t){if(e.isLeaf()){const i=e.value.substring(0,t),s=e.value.substring(t);return[new T(i),new T(s)]}if(t<e.weight){const[i,s]=this._split(e.left,t),o=new T(null,s,e.right);return[i,o]}else{const[i,s]=this._split(e.right,t-e.weight),o=new T(null,e.left,i);return o.weight=e.left.getTotalWeight(),[o,s]}}}class Oe{line;element;constructor(e){this.line=e}render(){return this.element||(this.element=document.createElement("span"),this.element.className="gutter-line-number",this.element.textContent=(this.line+1).toString()),this.element}getWidth(e){return this.element.getBoundingClientRect().width}}class ue{components=[];gutterComponents=[];add(e){this.components.push(e),e.range}set(e,t){this.components=[];for(const i of t)this.add(i)}getRanges(){return this.components.map(e=>e.range)}toRenderables(e,t=0){if(e??=this.components,!e.length)return[];let i=e.flatMap(u=>[{pos:u.range.begin,type:"start",component:u},{pos:u.range.end,type:"end",component:u}]);i.sort((u,p)=>u.pos-p.pos||(u.type==="end"?1:-1));const s=[];let o=[],h=t;for(const u of i){const p=u.pos;if(p>h)if(o.length===0){const g=document.createElement("span");g.textContent=" ".repeat(p-h),s.push(g)}else{const g=o.map(we=>we.className).join(" ").trim(),L=o[o.length-1],O=Math.max(h,L.range.begin),fe=Math.min(p,L.range.end),me=L.content.slice(O-L.range.begin,fe-L.range.begin),j=document.createElement("span");j.className=g,j.textContent=me,s.push(j)}if(u.type==="start")o.push(u.component);else{const g=o.indexOf(u.component);g!==-1&&o.splice(g,1)}h=p}return s}query(e){return this.components.filter(t=>e.contains(t.range))}gutterToRenderables(e){let t=this.gutterComponents.filter(i=>i.line===e);return[new Oe(e)].concat(t).map(i=>i.render())}clearRange(e){this.components=this.components.filter(t=>!t.range.overlaps(e))}}class w{static _isLocked=!1;static waiting=[];static _count=0;static _INSTANCE=null;static get INSTANCE(){if(!w._INSTANCE)throw new Error("Editor instance not acquired yet. Please call EditorInstance.acquire(editor) first.");return w._INSTANCE}static async acquireAsync(e){if(!this._INSTANCE&&!this._isLocked)this._isLocked=!0,this._INSTANCE=e,this._count=0;else{if(this._INSTANCE===e){this._count++;return}await new Promise(t=>this.waiting.push([e,t]))}}static release(){if(this._count!==0){this._count--;return}if(!this.waiting.length)this._isLocked=!1,this._INSTANCE=null;else{const[e,t]=this.waiting.shift();this._INSTANCE=e,t()}}static async with(e,t){await this.acquireAsync(e),t(),this.release()}static acquire(e){if(!this.waitForFlagSync())throw new Error("Error: Couldn't acquire editor instance in time. This is probably caused by an abnormal delay in an asynchronously running operation.");this._INSTANCE=e}static waitForFlagSync(e=2e3){if(!this._INSTANCE&&!this._isLocked)return!0;console.warn(`Warning: Editor instance is already acquired. Waiting for it to be released for a maximum of ${e}ms...`);const t=Date.now();for(;Date.now()-t<e;)if(!this._INSTANCE&&!this._isLocked)return!0;return!1}}class P{x;y;constructor(e,t){this.x=e,this.y=t}}class E{editor;constructor(e,t){this.editor=e,this._offset=t}_offset;get offset(){return this._offset}set offset(e){e<0?this._offset=0:e>this.editor.data.raw.length()?this._offset=this.editor.data.raw.length():this._offset=e}get x(){return this.toLogical().x}get y(){return this.toLogical().y}static fromOffset(e,t){return new this(e,t)}static fromLogical(e,t,i){return new this(e,e.calculateOffset(new P(t,i)))}static fromAbsolute(e,t,i){return new this(e,e.absoluteToOffset(t,i))}static fromVisual(e,t,i){let s=e.visualToNearestLogical(t,i);return E.fromLogical(e,s.x,s.y)}set(e,t){this._offset=this.editor.calculateOffset(new P(e,t))}createLogical(e,t){return E.fromLogical(this.editor,e,t)}createAbsolute(e,t){return E.fromAbsolute(this.editor,e,t)}createVisual(e,t){return E.fromVisual(this.editor,e,t)}toLogical(){return this.editor.offsetToLogical(this._offset)}toAbsolute(){return this.editor.offsetToAbsolute(this._offset)}toVisual(){return this.editor.logicalToVisual(this.toLogical())}toOffset(){return this._offset}isEOL(){return this.editor.offsetManager.lineEnd(this._offset)===this._offset}isBOL(){return this.editor.offsetManager.lineBegin(this._offset)===this._offset}clone(){return new E(this.editor,this._offset)}}class R{static _INSTANCES=new Map;ranges=new Set;rangesRegistry=new FinalizationRegistry(e=>{this.ranges.delete(e)});static get INSTANCE(){return R._INSTANCES.has(w.INSTANCE.id)||R._INSTANCES.set(w.INSTANCE.id,new R),R._INSTANCES.get(w.INSTANCE.id)}add(e){const t=new WeakRef(e);this.ranges.add(t),this.rangesRegistry.register(e,t)}updateRanges(e,t){for(const i of this.ranges){const s=i.deref();if(!s){this.ranges.delete(i);continue}s.begin>e&&(s.begin+=t),s.end>=e&&(s.end+=t)}}}class a{begin;end;constructor(e,t){R.INSTANCE.add(this),this.begin=e,this.end=t}static of(e,t){if(Array.isArray(e)){let i=e.filter(s=>s!==null);return i.length==1?i[0].range.clone():i.length==0?new a(0,0):new a(i[0].range.begin,i[i.length-1].range.end)}return t?new a(e.range.begin,t.range.end):e.range.clone()}static around(e){return new a(e,e+1)}moveBy(e){this.begin+=e,this.end+=e}overlaps(e){return this.begin<=e.end&&this.end>=e.begin}contains(e){return e instanceof a?this.begin<=e.begin&&this.end>=e.end:this.begin<=e&&this.end>=e}clone(){return new a(this.begin,this.end)}}class He{edac=new ue;raw;language="plaintext";srTree;constructor(e){this.raw=new B(e)}get text(){return this.raw.toString()}setLanguage(e){this.language=e}withContext(e){let t=this.srTree.scoping.toplevel();return{begin:t.range.begin,end:t.range.end,text:this.raw.getTextInRange(t.range),scope:t,containingNode:this.srTree.getContainingNodeAt(e)}}setComponentsAtRange(e,t){this.edac.set(e,t)}take(e,t,i){let s=[];for(let o=0;o<e;o++)s.push(this.getLine(t+o,i));return s}getLine(e,t){if(t.length<=e)return{gutter:[],content:[],line:e};{let i=new a(t[e],t[e+1]||this.raw.length());return{content:this.edac.toRenderables(this.edac.query(i),t[e]),gutter:this.edac.gutterToRenderables(e),line:e}}}}class Ne{data;lineBreaks=[0];constructor(e){this.data=e}offsetToLogical(e){let t=this.findFirstAfter(this.lineBreaks,e),i=t===-1?this.lineBreaks.length-1:t-1,s=e-this.lineBreaks[i];return new P(s,i)}absoluteToLogical(e){return e}logicalToAbsolute(e){return e}calculateOffset(e){return this.lineBreaks[e.y]+e.x}offset(e,t){this._offsetList(this.lineBreaks,e,t),R.INSTANCE.updateRanges(e,t)}recomputeNewLines(e,t,i=!1){let s=this.findFirstAfter(this.lineBreaks,e);s===-1&&(s=this.lineBreaks.length);for(const o of t.matchAll(/\r\n|\n|\r/g))if(i)this.lineBreaks.splice(this.lineBreaks.indexOf(e+o.index+o[0].length),1);else{let h=e+o.index+o[0].length;this.lineBreaks.splice(s,0,h),s++}}lineBegin(e){for(let t=1;t<this.lineBreaks.length;t++)if(e<this.lineBreaks[t])return this.lineBreaks[t-1];return this.lineBreaks[this.lineBreaks.length-1]}lineEnd(e){for(let t=1;t<this.lineBreaks.length;t++)if(e<this.lineBreaks[t])return this.lineBreaks[t]-1;return this.data.raw.length()}withLine(e){return this.data.raw.substring(this.lineBegin(e),this.lineEnd(e))}findFirstAfter(e,t){for(let i=0;i<e.length;i++)if(e[i]>t)return i;return-1}_offsetList(e,t,i){let s=this.findFirstAfter(e,t);if(s!==-1)for(let o=s;o<e.length;o++)e[o]+=i}}var x=(r=>(r.NUM0="0",r.NUM1="1",r.NUM2="2",r.NUM3="3",r.NUM4="4",r.NUM5="5",r.NUM6="6",r.NUM7="7",r.NUM8="8",r.NUM9="9",r.A="a",r.B="b",r.C="c",r.D="d",r.E="e",r.F="f",r.G="g",r.H="h",r.I="i",r.J="j",r.K="k",r.L="l",r.M="m",r.N="n",r.O="o",r.P="p",r.Q="q",r.R="r",r.S="s",r.T="t",r.U="u",r.V="v",r.W="w",r.X="x",r.Y="y",r.Z="z",r.ESCAPE="Escape",r.BACKSPACE="Backspace",r.DELETE="Delete",r.ENTER="Enter",r.TAB="Tab",r.ARROW_UP="ArrowUp",r.ARROW_DOWN="ArrowDown",r.ARROW_LEFT="ArrowLeft",r.ARROW_RIGHT="ArrowRight",r.PAGE_UP="PageUp",r.PAGE_DOWN="PageDown",r.HOME="Home",r.END="End",r.SPACE=" ",r.COMMA=",",r.PERIOD=".",r.SEMICOLON=";",r.QUOTE="'",r.SLASH="/",r.BACKSLASH="\\",r.DASH="-",r.EQUALS="=",r.LEFT_BRACKET="[",r.RIGHT_BRACKET="]",r.QUESTION_MARK="?",r.TILDE="~",r.CAPS_LOCK="CapsLock",r.INSERT="Insert",r))(x||{});class v{static instances=new Map;isCtrlPressed=!1;isAltPressed=!1;isShiftPressed=!1;isMouseDown=!1;isDragging=!1;static get isCtrlPressed(){return this.getInstance().isCtrlPressed}static get isAltPressed(){return this.getInstance().isAltPressed}static get isShiftPressed(){return this.getInstance().isShiftPressed}static get isMouseDown(){return this.getInstance().isMouseDown}static get isDragging(){return this.getInstance().isDragging}static getInstance(){let e=w.INSTANCE.id;return this.instances.has(e)||this.instances.set(e,new v),this.instances.get(e)}set(e){this.isCtrlPressed=e.ctrlKey??!1,this.isAltPressed=e.altKey??!1,this.isShiftPressed=e.shiftKey??!1,this.isMouseDown=e.button!==void 0&&e.button===0}setIsDragging(e){this.isDragging=e}clear(){this.isCtrlPressed=!1,this.isAltPressed=!1,this.isShiftPressed=!1,this.isMouseDown=!1,this.isDragging=!1}}var S=(r=>(r[r.LEFT=0]="LEFT",r[r.RIGHT=1]="RIGHT",r[r.UNKNOWN=2]="UNKNOWN",r))(S||{});class Ie{isSelectionActive;caret;start;end=null;constructor(e){this.caret=e,this.isSelectionActive=!1,this.caret.editor.addEditorEventListener(this)}get direction(){return!this.isSelectionActive||!this.start||!this.end?2:this.start.offset<this.end.offset?1:0}setStart(e){this.start=e.clone()}setEnd(e){this.end=e.clone()}setActive(e){this.isSelectionActive=e}clear(){this.isSelectionActive=!1,this.setStart(this.caret.position),this.end=null,console.log("Selection cleared.")}onCaretMove(e,t,i,s){if(!v.isShiftPressed&&!v.isDragging)return this.setStart(t.position),this.clear();this.setEnd(t.position),this.isSelectionActive||this.setActive(!0)}onCaretRemove(e,t){throw new Error("Method not implemented.")}getStart(){let e=this.start||this.caret.position;return this.end&&this.end.offset<e.offset?this.end:e}getEnd(){let e=this.end||this.caret.position;return this.start&&this.start.offset>e.offset?this.start:e}set(e,t){this.start=E.fromOffset(this.caret.editor,e),this.end=E.fromOffset(this.caret.editor,t),this.isSelectionActive=!0,console.log(`Selection set from ${e} to ${t}.`)}}class ie{id=0;isPrimary;position;editor;vertMovementPos=0;selectionModel;constructor(e,t,i){this.editor=e,this.isPrimary=t,this.position=i,this.selectionModel=new Ie(this)}moveToLogical(e,t){let i;typeof e=="number"?i=this.position.createLogical(e,t):i=this.position.createLogical(e.x,e.y);let s=this.position;this.position=i,this.editor.fire("onCaretMove",this,s,i)}moveToAbsolute(e,t){typeof e=="number"?e=this.position.createAbsolute(e,t):e=this.position.createAbsolute(e.x,e.y);let i=this.position;this.position=e,this.editor.fire("onCaretMove",this,i,e)}shift(e=1){let t=this.position.offset;this.position.offset+=e,this.editor.fire("onCaretMove",this,E.fromOffset(this.editor,t),this.position),this.vertMovementPos=0}setVertMovementPos(){this.vertMovementPos=Math.max(this.vertMovementPos,this.position.x)}remove(){this.editor.fire("onCaretRemove",this)}}class _e{editor;carets=[];constructor(e){this.editor=e,this.carets.push(new ie(e,!0,e.createLogical(0,0)))}get primary(){return this.carets.find(e=>e.isPrimary)}addCaret(e){const t=new ie(this.editor,!1,e);return this.carets.push(t),t}forEachCaret(e){for(const t of this.carets)e(t)}shift(e){this.forEachCaret(t=>t.shift(e))}removeAll(){for(let e=0;e<this.carets.length;e++)this.carets[e].isPrimary||(this.carets[e].remove(),this.carets.splice(e,1),e--)}}class d{isError=!1;type;value;range;isSpecial;isComment;constructor(e,t,i,s=!1,o=!1){this.type=e,this.value=t,this.range=i,this.isSpecial=s,this.isComment=o}}class F extends d{isError=!0;msg;constructor(e,t,i,s){super(e,t,s,!1,!1),this.msg=i}}class We{src;index=0;followupError=null;constructor(e){this.src=e}consume(){return this.index>=this.src.length?null:this.src[this.index++]}seek(){return this.index>=this.src.length?null:this.src[this.index]}seekNext(){return this.src[this.index+1]||null}find(e){return this.src.indexOf(e,this.index+1)}slice(e){return this.src.slice(this.index+1,e)}jump(e){this.index+=e}length(){return this.src.length-this.index}isEmpty(){return this.index>=this.src.length}clearError(){let e=this.followupError;return this.followupError=null,e}}class ce{skipSpecial=!0;skipComments=!0;static of(...e){return new Q(e)}}class Q extends ce{tokens;index=0;constructor(e){super(),this.tokens=e}clone(){return new Q(this.tokens.slice())}isEmpty(){return this.index>=this.tokens.length}seek(){return this.seekN(0)}seekIncludeSpecial(){return this.tokens[this.index]}seekN(e){let t,i=this.index+e;do t=this.tokens[i],i+=Math.sign(e)||1;while(t&&(this.skipComments&&t.isComment||this.skipSpecial&&t.isSpecial));return t||null}seekPrevious(){return this.seekN(-1)}consume(){const e=this.seek();return e&&this.index++,e}exhaust(){let e=this.index;for(;!this.isEmpty();)this.consume();return this.tokens.slice(e)}includeComments(){this.skipComments=!1}includeSpecial(){this.skipSpecial=!1}}class W extends ce{lexer;src;tokens=[];index=0;computed=0;constructor(e,t,i=!0){super(),this.lexer=e,this.src=new We(t),this.skipSpecial=i}clone(){const e=new W(this.lexer,this.src.src,this.skipSpecial);return e.index=this.index,e.computed=this.computed,e.tokens=[...this.tokens],this.skipComments||e.includeComments(),e}isEmpty(){return this.src.isEmpty()&&!this.src.followupError}consume(){const e=this.seek();return this.index++,this.computed--,e}seek(){return this.seekN(0)}seekIncludeSpecial(){let e=this.skipSpecial;this.skipSpecial=!1;let t=this.seek();return this.skipSpecial=e,t}seekN(e){for(;this.computed<=e;)this.compute();return this.tokens[this.index+e]||null}seekPrevious(){return this.seekN(-1)}exhaust(){let e=this.index;for(;!this.isEmpty();)this.compute();return this.tokens.slice(e)}includeComments(){this.skipComments=!1}includeSpecial(){this.skipSpecial=!1}compute(){const e=this.lexer.tokenize(this.src);if(e){if(this.skipSpecial&&e.isSpecial)return this.compute();if(this.skipComments&&e.isComment)return this.compute();this.computed++,this.tokens.push(e)}}}class Ve{EOF;compiledMatchers;specialChars=[];comments=[];setRules(e){this.compiledMatchers=e.map(({matcher:t,type:i,getValue:s})=>({matcher:new RegExp(t.source,"y"),type:i,getValue:s}))}setEOF(e){this.EOF=e}setSpecial(...e){this.specialChars=e}setComments(...e){this.comments=e}tokenize(e){if(e.isEmpty())return new d(this.EOF,"",new a(e.index,e.index),!1,!1);for(const t of this.compiledMatchers){t.matcher.lastIndex=e.index;const i=t.matcher.exec(e.src);if(i&&(e.jump(i[0].length),t.type!==null)){const s=t.getValue?t.getValue(i[0]):i[0],o=this.specialChars.includes(t.type),h=this.comments.includes(t.type);return new d(t.type,s,new a(e.index-i[0].length,e.index),o,h)}}throw"Unexpected token at index "+e.index+" in source: "+e.src}}class De extends Ve{constructor(){super(),this.setRules([{matcher:/\r\n|\n|\r/,type:"EOL"},{matcher:/([^\r\n]+)/,type:"Default"}]),this.setEOF("EOF"),this.setSpecial("EOL")}asTokenStream(e){return new W(this,e)}}class de{*highlight(e){for(;!e.isEmpty();){const t=e.consume();if(t){const i=this._impl[`visit${t.type}`];let s=i(t);s&&(yield s)}}}}class je{token;range;span=null;className="default-lang-token";content;constructor(e){this.token=e,this.range=e.range.clone(),this.content=e.value}getWidth(e){return this.token.value.length*e.getCharSize()}render(){return this.span=c.createElement("span"),this.span.textContent=this.token.value,this.span}update(){}destroy(){this.span&&(this.span.remove(),this.span=null)}}class Ue extends de{_impl=this;visitEOL(e){return null}visitEOF(e){return null}visitDefault(e){return new je(e)}}class qe{scoping;code;parser;constructor(e,t){this.scoping=e.createScopeManager(),this.code=e.parse(this.scoping.toplevel(),t),this.parser=e}patch(e,t){e.children!==void 0&&(e.children=t)}getContainingNodeAt(e){return this.scoping.getContainingNodeAt(e)||this.code}}class Ye{static componentIdCounter=0;static actionIdCounter=0;static getComponentId(e){return`${e}-${this.componentIdCounter++}`}static getActionId(e){return`${this.actionIdCounter++}-${e}`}}class k{id;name;description;keybinding;constructor(){this.id=Ye.getActionId(this.name)}}class ze extends k{name="Delete";description="Delete the selected text or the character after the caret.";keybinding={key:x.DELETE,ctrl:!1,alt:!1,shift:!1};run(e,t){e.caretModel.forEachCaret(i=>{i.selectionModel.isSelectionActive?e.deleteSelection(i):e.deleteAt(i.position.offset)}),e.view.resetBlink()}}class Ge extends k{name="Backspace";description="Delete the selected text or the character at the caret position.";keybinding={key:x.BACKSPACE,ctrl:!1,alt:!1,shift:!1};run(e,t){e.caretModel.forEachCaret(i=>{i.selectionModel.isSelectionActive?e.deleteSelection(i):(e.deleteAt(i.position.offset-1),i.shift(-1))}),e.view.resetBlink()}}function V(r,e){let t=r.selectionModel.start;r.selectionModel.clear(),e&&r.moveToLogical(t)}class Xe extends k{name="MoveCaretLeft";description="Move the caret to the left by one character.";keybinding={key:x.ARROW_LEFT,ctrl:!1,alt:!1,shift:!1};run(e,t){e.caretModel.forEachCaret(i=>{let s=i.selectionModel.direction;!t.shiftKey&&s!==S.UNKNOWN?V(i,s===S.RIGHT):i.shift(-1)}),e.view.resetBlink()}}class $e extends k{name="MoveCaretRight";description="Move the caret to the right by one character.";keybinding={key:x.ARROW_RIGHT,ctrl:!1,alt:!1,shift:!1};run(e,t){e.caretModel.forEachCaret(i=>{let s=i.selectionModel.direction;!t.shiftKey&&s!==S.UNKNOWN?V(i,s===S.LEFT):i.shift(1)}),e.view.resetBlink()}}class Ke extends k{name="MoveCaretUp";description="Move the caret up one line.";keybinding={key:x.ARROW_UP,ctrl:!1,alt:!1,shift:!1};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{if(!t.shiftKey&&i.selectionModel.direction!==S.UNKNOWN&&V(i,i.selectionModel.direction===S.RIGHT),i.position.y===0)return;i.setVertMovementPos();let s=e.createLogical(Math.min(e.getLineLength(i.position.y-1),i.vertMovementPos),i.position.y-1);i.moveToLogical(s)})}}class Qe extends k{name="MoveCaretDown";description="Move the caret down one line.";keybinding={key:x.ARROW_DOWN,ctrl:null,alt:!1,shift:null};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{if(!t.shiftKey&&i.selectionModel.direction!==S.UNKNOWN&&V(i,i.selectionModel.direction===S.LEFT),i.position.y>=e.getLineCount()-1)return;i.setVertMovementPos();let s=e.createLogical(Math.min(e.getLineLength(i.position.y+1),i.vertMovementPos),i.position.y+1);i.moveToLogical(s)})}}class Ze extends k{name="MoveCaretToStart";description="Move the caret to the start of the line.";keybinding={key:x.HOME,ctrl:!1,alt:!1,shift:!1};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{i.vertMovementPos=0,i.moveToLogical(e.createLogical(0,i.position.y))})}}class Je extends k{name="MoveCaretToEnd";description="Move the caret to the end of the line.";keybinding={key:x.END,ctrl:!1,alt:!1,shift:!1};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{let s=e.getLineLength(i.position.y);i.vertMovementPos=s,i.moveToLogical(e.createLogical(s,i.position.y))})}}class et extends k{name="TabAction";description="Insert a tab character at the caret position.";keybinding={key:x.TAB,ctrl:!1,alt:!1,shift:!1};run(e,t){t.preventDefault(),e.caretModel.forEachCaret(i=>{e.insertText(i.position.offset,"    "),e.caretModel.shift(4)}),e.view.resetBlink()}}class tt extends k{name="SelectAll";description="Select all text in the editor.";keybinding={key:x.A,ctrl:!0,alt:!1,shift:!1};run(e,t){e.caretModel.removeAll(),e.caretModel.primary.selectionModel.set(0,e.data.raw.length()),e.view.resetBlink()}}class it{editor;actions=[];constructor(e){this.editor=e,this.addAction(new Xe),this.addAction(new $e),this.addAction(new Ke),this.addAction(new Qe),this.addAction(new Ze),this.addAction(new Je),this.addAction(new ze),this.addAction(new et),this.addAction(new Ge),this.addAction(new tt)}addAction(e){this.actions.push(e),e.keybinding&&this.editor.eventsManager.addKeybindingListener(e.keybinding,e.run)}}class Z extends he{static ID=0;id;properties;file;project;view;root;data;caretModel;offsetManager;eventsManager;actions;plugins;perfCheckRunning=!1;defaultLexer=new De;defaultHighlighter=new Ue;constructor(e,t){super(),this.id=Z.ID++,this.properties=t||{},this.file=this.properties.file||new Be("temp","","js"),e&&e.addFile(this.file),this.project=e||Me.singleFileProject(this.file),this.eventsManager=new Ae,this.eventsManager.addVisualEventListener(this),this.data=new He(this.file.read()),this.data.setLanguage(this.file.type),this.view=new Pe(this),this.offsetManager=new Ne(this.data),this.caretModel=new _e(this),this.actions=new it(this),this.plugins=new Fe(this),setInterval(()=>{w.with(this,()=>{this.view.render()})},20)}attach(e){w.with(this,()=>{this.data.srTree=new qe(this.getParserForFileType(this.data.language),this.getLexerForFileType(this.data.language).asTokenStream(this.data.text)),this.root=c.createElement("div.editor",e),this.view.onAttached(this,this.root),this.fire("onAttached",this.root)})}fire(e,...t){w.with(this,()=>this.eventsManager.fire(e,this,...t))}fireKeybinding(e){w.with(this,()=>this.eventsManager.fireKeybinding(e,this))}registerPlugin(e){w.with(this,()=>{this.plugins.register(e)})}addVisualEventListener(e){this.eventsManager.addVisualEventListener(e)}addEditorEventListener(e){this.eventsManager.addEditorEventListener(e)}registerKeybinding(e,t){this.eventsManager.addKeybindingListener(e,t)}getRawData(){return this.data.raw}getLexerForFileType(e){return this.plugins.getLexerForFileType(e)||this.defaultLexer}getHighlighterForFileType(e){return this.plugins.getHighlighterForFileType(e)||this.defaultHighlighter}getParserForFileType(e){return this.plugins.getParserForFileType(e)}getCurrentLexer(){return this.getLexerForFileType(this.data.language)}getCurrentHighlighter(){return this.getHighlighterForFileType(this.data.language)}getCurrentParser(){return this.getParserForFileType(this.data.language)}parse(e,t){return this.getCurrentParser().parse(e,t.clone())}offsetToLogical(e){return e<0?e=0:e>this.data.raw.length()&&(e=this.data.raw.length()-1),this.offsetManager.offsetToLogical(e)}absoluteToOffset(e,t){return this.offsetManager.calculateOffset(this.offsetManager.absoluteToLogical(new P(e,t)))}offsetToAbsolute(e){return this.offsetManager.logicalToAbsolute(this.offsetToLogical(e))}calculateOffset(e){return this.offsetManager.calculateOffset(e)}visualToNearestLogical(e,t){const i=this.view.getCharSize(),s=this.view.getLineHeight(),o=this.view.scroll.scrollXOffset===0?this.view.scroll.scrollXChars:this.view.scroll.scrollXChars-1,h=this.view.scroll.scrollYOffset===0?this.view.scroll.scrollYLines:this.view.scroll.scrollYLines-1,u=Math.round((e+this.view.scroll.scrollXOffset)/i)+o,p=Math.floor((t+this.view.scroll.scrollYOffset)/s)+h;return new P(u,p)}logicalToVisual(e){const t=this.view.getCharSize(),i=this.view.getLineHeight(),s=this.view.scroll.scrollYOffset===0?this.view.scroll.scrollYLines:this.view.scroll.scrollYLines-1,o=(e.x-this.view.scroll.scrollXChars)*t-this.view.scroll.scrollXOffset,h=(e.y-s)*i-this.view.scroll.scrollYOffset;return new P(o,h)}createLogical(e,t){return E.fromLogical(this,e,t)}createAbsolutePosition(e,t){return E.fromAbsolute(this,e,t)}createPositionFromOffset(e){return E.fromOffset(this,e)}createVisualPosition(e,t){return E.fromVisual(this,e,t)}getFullRange(){return new a(0,this.data.raw.length())}isValidOffset(e){return e>=0&&e<=this.data.raw.length()}moveCursorToMouseEvent(e){let[t,i]=this.view.getRelativePos(e),s=this.visualToNearestLogical(t,i);s.y<0?s.y=0:s.y>=this.getLineCount()&&(s.y=this.getLineCount()-1),s.x=Math.max(0,Math.min(s.x,this.getLineLength(s.y))),this.caretModel.primary.moveToLogical(s),this.view.resetBlink()}type(e){w.with(this,()=>{this.caretModel.forEachCaret(t=>{t.selectionModel.isSelectionActive&&this.deleteSelection(t),this.insertText(t.position.toOffset(),e),t.shift(),this.view.resetBlink()})})}insertText(e,t){this.data.raw.insert(e,t),this.offsetManager.offset(e,t.length),this.offsetManager.recomputeNewLines(e,t);let i=this.getCurrentLexer(),s=this.getCurrentHighlighter(),o=this.data.withContext(e);o.scope.clear();let h=i.asTokenStream(o.text);this.data.srTree.patch(o.containingNode,this.parse(o.scope,h).children);let u=s.highlight(h);this.data.setComponentsAtRange(o.scope.range,u)}deleteAt(e,t=1){if(e<0||e>=this.data.raw.length())return;let i=this.data.raw.delete(e,t);this.offsetManager.recomputeNewLines(e,i,!0),this.offsetManager.offset(e,-t);let s=this.getCurrentLexer(),o=this.getCurrentHighlighter(),h=this.data.withContext(e);h.scope.clear();let u=s.asTokenStream(h.text);this.data.srTree.patch(h.containingNode,this.parse(h.scope,u).children);let p=o.highlight(u);this.data.setComponentsAtRange(h.scope.range,p)}deleteSelection(e){let t=e.selectionModel;if(!t.isSelectionActive)return;let i=t.getStart().toOffset(),s=t.getEnd().toOffset();this.deleteAt(i,s-i),e.moveToLogical(E.fromOffset(this,i))}take(e,t){return this.data.take(e,t,this.offsetManager.lineBreaks)}getLine(e){return this.data.getLine(e,this.offsetManager.lineBreaks)}getLineCount(){return this.offsetManager.lineBreaks.length}getLineLength(e){let t=this.offsetManager.lineBreaks[e];return(this.offsetManager.lineBreaks[e+1]-1||this.data.raw.length())-t}onKeyUp(e,t){v.getInstance().clear()}onKeyDown(e,t){if(t.key===x.ENTER)return v.getInstance().clear(),this.type(`
`);v.getInstance().set(t),this.fireKeybinding(t)}onMouseDown(e,t){v.getInstance().set(t),this.caretModel.removeAll(),this.moveCursorToMouseEvent(t)}onMouseUp(e,t){v.getInstance().clear()}onMouseMove(e,t){v.isMouseDown&&(v.getInstance().setIsDragging(!0),this.moveCursorToMouseEvent(t))}onInput(e,t){v.getInstance().clear(),t.data&&this.type(t.data)}perfCheckBegin(){let e=performance.now();this.perfCheckRunning=!0;let t=()=>this.perfCheckRunning;requestAnimationFrame(function i(s){let h=1e3/(s-e);console.log(`FPS: ${h.toFixed(2)}`),e=s,t()&&requestAnimationFrame(i)})}perfCheckEnd(){this.perfCheckRunning=!1}}var n=(r=>(r.Keyword="Keyword",r.Identifier="Identifier",r.Number="Number",r.String="String",r.Punctuation="Punctuation",r.LPAREN="LeftParen",r.RPAREN="RightParen",r.LBRACE="LeftBrace",r.RBrace="RightBrace",r.LBRACKET="LeftBracket",r.RBRACKET="RightBracket",r.Operator="Operator",r.UnOperator="UnOperator",r.IncrDecrOp="IncrDecrOp",r.Equals="Equals",r.EqualOp="EqualOp",r.CompareOp="CompareOp",r.Arrow="Arrow",r.EOL="EOL",r.EOF="EOF",r.SyntaxError="SyntaxError",r))(n||{});class D{static KEYWORDS=["var","let","const","if","else","switch","case","default","for","while","do","break","continue","return","try","catch","finally","throw","function","class","extends","super","this","new","await","async","yield","yield*","in","instanceof","delete","typeof","void","debugger","import","export","abstract","arguments","boolean","byte","char","double","enum","final","float","goto","implements","int","interface","long","native","package","private","protected","public","short","static","synchronized","throws","transient","volatile"];asTokenStream(e){return new W(this,e)}tokenize(e){if(e.followupError)return e.clearError();for(;;){if(e.isEmpty())return new d("EOF","EOF",new a(e.index,e.index));let t=e.consume();if(t===`
`)return new d("EOL",`
`,a.around(e.index-1),!0);if(t!==" ")if(t>="0"&&t<="9"){let i=t;for(;!e.isEmpty()&&e.seek()>="0"&&e.seek()<="9";)i+=e.consume();return new d("Number",i,new a(e.index-i.length,e.index))}else if(this.isAlphanumeric(t)){let i=t;for(;!e.isEmpty()&&this.isAlphanumeric(e.seek());)i+=e.consume();return D.KEYWORDS.includes(i)?new d("Keyword",i,new a(e.index-i.length,e.index)):new d("Identifier",i,new a(e.index-i.length,e.index))}else{if(t==="(")return new d("LeftParen","(",a.around(e.index-1));if(t===")")return new d("RightParen",")",a.around(e.index-1));if(t==="{")return new d("LeftBrace","{",a.around(e.index-1));if(t==="}")return new d("RightBrace","}",a.around(e.index-1));if(t==="[")return new d("LeftBracket","[",a.around(e.index-1));if(t==="]")return new d("RightBracket","]",a.around(e.index-1));if(t===".")return e.seek()==="."&&e.seekNext()==="."?(e.consume(),e.consume(),new d("Punctuation","...",new a(e.index-3,e.index))):new d("Punctuation",".",a.around(e.index-1));if(t===","||t===";"||t===":")return new d("Punctuation",t,a.around(e.index-1));if(t==="=")return e.seek()==="="?(e.consume(),e.seek()==="="?(e.consume(),new d("CompareOp","===",new a(e.index-3,e.index))):new d("CompareOp","==",new a(e.index-2,e.index))):e.seek()===">"?(e.consume(),new d("Arrow","=>",new a(e.index-2,e.index))):new d("Equals","=",a.around(e.index-1));if(t=="+"||t==="-"||t==="*"||t==="/")return e.seek()==="="?(e.consume(),new d("EqualOp",t+"=",new a(e.index-2,e.index))):t===e.seek()?(e.consume(),t==="+"||t==="-"?new d("IncrDecrOp",t+t,new a(e.index-2,e.index)):new d("Operator",t+t,a.around(e.index-2))):new d("Operator",t,a.around(e.index-1));if(t===">"||t==="<")return e.seek()==="="?(e.consume(),new d("CompareOp",t+"=",new a(e.index-2,e.index))):e.seek()===t?(e.consume(),t===">"&&e.seek()===">"?(e.consume(),new d("Operator",">>>",new a(e.index-3,e.index))):new d("Operator",t+t,new a(e.index-2,e.index))):new d("CompareOp",t,a.around(e.index-1));if(t==="|"||t==="&"||t==="?"||t==="^")return e.seek()==="="?new d("EqualOp",t+"=",a.around(e.index-2)):e.seek()===t&&t!=="^"?(e.consume(),new d("Operator",t+t,new a(e.index-2,e.index))):t!=="?"?new d("Operator",t,a.around(e.index-1)):new d("Punctuation","?",a.around(e.index-1));if(t==="!"||t==="~")return new d("UnOperator",t,a.around(e.index-1));if(t==="'"||t==='"'){let i=t;for(;!e.isEmpty()&&e.seek()!==t&&e.seek()!==`
`;)i+=e.consume();return e.seek()===t?(i+=e.consume(),new d("String",i,new a(e.index-i.length,e.index))):(e.followupError=new F("SyntaxError",i[i.length-1],"Unterminated string literal",a.around(e.index-1)),new d("String",i,new a(e.index-i.length,e.index)))}else return new F("SyntaxError",t,"Unexpected char: "+t,a.around(e.index-1))}}}isAlphanumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_"||e==="$"}}class f{range;element=null;className;content;constructor(e,t){this.content=e.value,this.range=e.range.clone(),this.className="editor-ht "+t}render(){throw new Error("Method not implemented. Use `data.edac.toRenderable()` instead.")}update(){throw new Error("Method not implemented. Use `data.edac.update()` instead.")}destroy(){throw new Error("Method not implemented.")}getWidth(e){return this.content.length*e.getCharSize()}}class st extends de{_impl=this;visitEqualOp(e){return new f(e,"js-operator")}visitCompareOp(e){return new f(e,"js-operator")}visitArrow(e){return new f(e,"js-operator")}visitUnOperator(e){return new f(e,"js-operator")}visitIncrDecrOp=e=>new f(e,"js-operator");visitString(e){return new f(e,"js-string")}visitIdentifier(e){return new f(e,"js-identifier")}visitNumber(e){return new f(e,"js-number")}visitPunctuation(e){return new f(e,"js-default")}visitLeftParen(e){return new f(e,"js-left-paren js-default")}visitRightParen(e){return new f(e,"js-right-paren js-default")}visitLeftBrace(e){return new f(e,"js-left-brace js-default")}visitRightBrace(e){return new f(e,"js-right-brace js-default")}visitLeftBracket(e){return new f(e,"js-left-bracket js-default")}visitRightBracket(e){return new f(e,"js-right-bracket js-default")}visitOperator(e){return new f(e,"js-operator")}visitEquals(e){return new f(e,"js-operator")}visitEOL(e){return null}visitEOF(e){return null}visitSyntaxError(e){return new f(e,"js-syntax-error")}visitKeyword(e){return new f(e,"js-keyword")}}class pe{static indent(e,t=4){const i=" ".repeat(t);return e.split(`
`).map(s=>i+s).join(`
`)}}class l{static tokenToHumanReadableString(e){return e?e.isError?`#${e.type}<${e.msg}>`:e.value:"#undef"}static toHumanReadableString(e){return e?e.toHumanReadableString():"#undef"}static isValidToken(e){return!!e&&!e.isError&&!e.isSpecial}}class I{static precedenceMap={"**":15,"*":14,"/":14,"+":13,"-":13,"<<":12,">>":12,">>>":12};static isRightAssociative(e){return e==="**"}static getPrecedence(e){return I.precedenceMap[e]}}var C=(r=>(r.CodeBlock="CodeBlock",r.Stmt="Stmt",r.DeclStmt="DeclStmt",r.Body="Body",r.Parameters="Parameters",r.Param="Param",r.FuncDeclStmt="FuncDeclStmt",r.ReturnStmt="ReturnStmt",r.Expr="Expr",r.ExprGroup="ExprGroup",r.ExprCommaExpr="ExprCommaExpr",r.NumberLiteral="NumberLiteral",r.StringLiteral="StringLiteral",r.Args="Args",r.Identifier="Identifier",r.SpecialIdentifier="SpecialIdentifier",r.MemberAccess="MemberAccess",r.AssignExpr="AssignExpr",r.UnaryExpr="UnaryExpr",r.BinaryExpr="BinaryExpr",r.TernaryExpr="TernaryExpr",r.CallExpr="CallExpr",r.NewExpr="NewExpr",r.ArrayAccess="ArrayAccess",r.ArrayLiteral="ArrayLiteral",r.ObjectLiteral="ObjectLiteral",r.ObjectLiteralProperty="ObjectLiteralProperty",r.ObjectLiteralPropertyFunction="ObjectLiteralPropertyFunction",r.Lambda="Lambda",r))(C||{});class b{range;language="js";parent=null;constructor(){for(let e of this.getAllNodeChildren())e.parent=this}getAllNodeChildren(){const e=[];for(let t in this)this[t]instanceof b&&e.push(this[t]);return e}}class se extends b{range;children;nodeType="CodeBlock";constructor(e){super(),this.children=e,this.range=a.of(e)}toHumanReadableString(){let e="";for(const t of this.children)e+=t.toHumanReadableString()+`
`;return`{
`+pe.indent(e.substring(0,e.length-1))+`
}`}isWellFormed(){return this.children.every(e=>e.isWellFormed())}}class J extends b{range;nodeType="Stmt";constructor(e){super(),this.range=e}}class U extends J{kind;name;eq;decl;nodeType="DeclStmt";constructor(e,t,i,s){super(a.of(e,s||t)),this.kind=e,this.name=t,this.eq=i,this.decl=s}isWellFormed(){return this.kind&&this.name&&l.isValidToken(this.kind)&&l.isValidToken(this.name)&&(!this.eq||l.isValidToken(this.eq))&&(!this.decl||this.decl.isWellFormed())}toHumanReadableString(){let e=l.tokenToHumanReadableString(this.kind);return e+=" "+l.tokenToHumanReadableString(this.name)+" = ",e+=l.toHumanReadableString(this.decl),e+";"}}class q extends J{keyword;expr;nodeType="ReturnStmt";constructor(e,t){super(a.of([e,t])),this.keyword=e,this.expr=t}isWellFormed(){return l.isValidToken(this.keyword)&&(!this.expr||this.expr.isWellFormed())}toHumanReadableString(){return"return "+l.toHumanReadableString(this.expr)+";"}}class Y extends b{openBrace;body;closeBrace;nodeType="Body";constructor(e,t,i){super(),this.range=a.of([e,t,i]),this.openBrace=e,this.body=t,this.closeBrace=i}isWellFormed(){return(!this.openBrace||l.isValidToken(this.openBrace))&&this.body.isWellFormed()&&(!this.closeBrace||l.isValidToken(this.closeBrace))}toHumanReadableString(){return l.toHumanReadableString(this.body)}}class H extends b{params;commas=[];nodeType="Parameters";constructor(e,t=[]){super(),this.range=a.of(e),this.params=e,this.commas=t}toHumanReadableString(){return this.params.map(e=>l.toHumanReadableString(e)).join(", ")}isWellFormed(){return this.params.every(e=>e.isWellFormed())}}class y extends b{restToken;name;eqSign;defaultValue;nodeType="Param";constructor(e,t,i,s){super(),this.name=e,this.restToken=t,this.eqSign=i,this.defaultValue=s,this.range=s?a.of(t||e,s):a.of(t||e,i||e)}isWellFormed(){return l.isValidToken(this.name)&&(!this.restToken||l.isValidToken(this.restToken))&&(!this.eqSign||l.isValidToken(this.eqSign))&&(!this.defaultValue||this.defaultValue.isWellFormed())}toHumanReadableString(){let e=this.restToken?"...":"";return e+=l.tokenToHumanReadableString(this.name),this.eqSign&&(e+="=",e+=l.toHumanReadableString(this.defaultValue)),e}}class N extends J{keyword;name;openParen;params;closeParen;body;nodeType="FuncDeclStmt";constructor(e,t,i,s,o,h){super(a.of([e,t,i,s,o,h])),this.keyword=e,this.name=t,this.openParen=i,this.params=s,this.closeParen=o,this.body=h}isWellFormed(){return l.isValidToken(this.keyword)&&(!this.name||l.isValidToken(this.name))&&l.isValidToken(this.openParen)&&l.isValidToken(this.closeParen)&&this.params.isWellFormed()&&this.body.isWellFormed()}toHumanReadableString(){let e=l.tokenToHumanReadableString(this.keyword);return this.name&&(e+=" "+l.tokenToHumanReadableString(this.name)),e+="("+l.toHumanReadableString(this.params)+")",e+" "+l.toHumanReadableString(this.body)}}class m extends b{error;nodeType="Expr";constructor(e=null){super(),this.error=e,e&&(this.range=a.of(e))}toHumanReadableString(){return l.tokenToHumanReadableString(this.error)}isWellFormed(){return!this.error}}class rt extends m{values;commas;nodeType="ExprCommaExpr";constructor(e,t){super(),this.values=e,this.commas=t,this.range=a.of(e)}toHumanReadableString(){return this.values.map(e=>l.toHumanReadableString(e)).join(", ")}isWellFormed(){return this.values.every(e=>e.isWellFormed())}}class nt extends m{value;nodeType="NumberLiteral";constructor(e){super(),this.range=a.of(e),this.value=e}toHumanReadableString(){return l.tokenToHumanReadableString(this.value)}isWellFormed(){return l.isValidToken(this.value)}}class ot extends m{value;nodeType="StringLiteral";constructor(e){super(),this.range=a.of(e),this.value=e}toHumanReadableString(){return l.tokenToHumanReadableString(this.value)}isWellFormed(){return l.isValidToken(this.value)}}class re extends m{openBracket;values;closeBracket;commas;nodeType="ArrayLiteral";constructor(e,t,i,s){super(),this.openBracket=e,this.values=t,this.closeBracket=i,this.commas=s,this.range=a.of([e,...t,i])}toHumanReadableString(){return"["+this.values.map(e=>l.toHumanReadableString(e)).join(", ")+"]"}isWellFormed(){return l.isValidToken(this.openBracket)&&this.values.every(e=>e.isWellFormed())&&l.isValidToken(this.closeBracket)}}class M extends b{key;colon;value;nodeType="ObjectLiteralProperty";constructor(e,t,i){super(),this.key=e,this.colon=t,this.value=i,this.range=a.of([e,t,i])}isWellFormed(){return l.isValidToken(this.key)&&(!this.colon||l.isValidToken(this.colon))&&(!this.value||this.value.isWellFormed())}toHumanReadableString(){let e=this.key.value;return(this.colon&&!this.colon.isError||this.value)&&(e+=": "),this.value?e+=this.value.toHumanReadableString():e+="#undef",e}}class lt extends M{func;nodeType="ObjectLiteralPropertyFunction";constructor(e){super(e.name,null,e),this.func=e}isWellFormed(){return this.func.isWellFormed()}toHumanReadableString(){return l.toHumanReadableString(this.func)}}class ne extends m{openBrace;properties;closeBrace;commas;nodeType="ObjectLiteral";constructor(e,t,i,s){super(),this.openBrace=e,this.properties=t,this.closeBrace=i,this.commas=s,this.range=a.of([e,...t,i])}isWellFormed(){return l.isValidToken(this.openBrace)&&this.properties.every(e=>e.isWellFormed())&&(!this.closeBrace||l.isValidToken(this.closeBrace))}toHumanReadableString(){if(this.properties.length<=2&&!this.properties.some(e=>e.nodeType==="ObjectLiteralPropertyFunction"))return"{ "+this.properties.map(e=>e.toHumanReadableString()).join(", ")+" }";{let e=`{
`;for(const t of this.properties)e+=pe.indent(t.toHumanReadableString())+`,
`;return e+="}",e}}}class $ extends m{token;nodeType="Identifier";constructor(e){super(),this.token=e,this.range=a.of(e)}isWellFormed(){return l.isValidToken(this.token)}toHumanReadableString(){return l.tokenToHumanReadableString(this.token)}}class at extends ${nodeType="SpecialIdentifier";constructor(e){super(e)}}class ht extends m{base;dot;member;nodeType="MemberAccess";constructor(e,t,i){super(),this.base=e,this.dot=t,this.member=i,this.range=a.of(e,i)}isWellFormed(){return this.base.isWellFormed()&&l.isValidToken(this.dot)&&this.member.isWellFormed()}toHumanReadableString(){return l.toHumanReadableString(this.base)+"."+l.toHumanReadableString(this.member)}}class ut extends m{left;operator;right;nodeType="AssignExpr";constructor(e,t,i){super(),this.left=e,this.operator=t,this.right=i,this.range=a.of(e,i||t)}isWellFormed(){return this.left.isWellFormed()&&l.isValidToken(this.operator)&&(!this.right||this.right.isWellFormed())}toHumanReadableString(){return"("+l.toHumanReadableString(this.left)+" = "+l.toHumanReadableString(this.right)+")"}}class z extends m{operator;operand;nodeType="UnaryExpr";constructor(e,t){super(),this.operator=e,this.operand=t,this.range=a.of(e,t)}isWellFormed(){return l.isValidToken(this.operator)&&this.operand.isWellFormed()}toHumanReadableString(){return"("+l.tokenToHumanReadableString(this.operator)+l.toHumanReadableString(this.operand)+")"}}class A extends m{left;operator;right;nodeType="BinaryExpr";constructor(e,t,i){super(),this.left=e,this.operator=t,this.right=i,this.range=a.of(e,i)}isWellFormed(){return this.left.isWellFormed()&&l.isValidToken(this.operator)&&this.right.isWellFormed()}toHumanReadableString(){return"("+l.toHumanReadableString(this.left)+" "+l.tokenToHumanReadableString(this.operator)+" "+l.toHumanReadableString(this.right)+")"}}class oe extends m{condition;questionMark;trueExpr;colon;falseExpr;nodeType="TernaryExpr";constructor(e,t,i,s,o){super(),this.condition=e,this.questionMark=t,this.trueExpr=i,this.colon=s,this.falseExpr=o,this.range=a.of(e,o||s)}isWellFormed(){return this.condition.isWellFormed()&&l.isValidToken(this.questionMark)&&this.trueExpr.isWellFormed()&&l.isValidToken(this.colon)&&(!this.falseExpr||this.falseExpr.isWellFormed())}toHumanReadableString(){return l.toHumanReadableString(this.condition)+" ? ("+l.toHumanReadableString(this.trueExpr)+") : ("+l.toHumanReadableString(this.falseExpr)+")"}}class K extends m{callee;openParen;args;closeParen;nodeType="CallExpr";constructor(e,t,i,s){super(),this.callee=e,this.openParen=t,this.args=i,this.closeParen=s,this.range=a.of([e,t,i,s])}isWellFormed(){return this.callee.isWellFormed()&&l.isValidToken(this.openParen)&&l.isValidToken(this.closeParen)&&this.args.isWellFormed()}toHumanReadableString(){return l.toHumanReadableString(this.callee)+"("+l.toHumanReadableString(this.args)+")"}}class le extends m{base;openBracket;index;closeBracket;nodeType="ArrayAccess";constructor(e,t,i,s){super(),this.base=e,this.openBracket=t,this.index=i,this.closeBracket=s,this.range=a.of([e,t,i,s])}isWellFormed(){return this.base.isWellFormed()&&l.isValidToken(this.openBracket)&&this.index.isWellFormed()&&l.isValidToken(this.closeBracket)}toHumanReadableString(){return l.toHumanReadableString(this.base)+"["+l.toHumanReadableString(this.index)+"]"}}class G extends K{keyword;nodeType="NewExpr";constructor(e,t,i,s,o){super(t,i,s,o),this.keyword=e,this.range.begin=e.range.begin}isWellFormed(){return l.isValidToken(this.keyword)&&this.callee.isWellFormed()&&l.isValidToken(this.openParen)&&this.args.isWellFormed()&&l.isValidToken(this.closeParen)}toHumanReadableString(){return"new "+l.toHumanReadableString(this.callee)+"("+l.toHumanReadableString(this.args)+")"}}class ct extends m{values;comma;nodeType="Args";constructor(e,t){super(),this.values=e,this.comma=t,this.range=a.of(e)}isWellFormed(){return this.values.every(e=>e.isWellFormed())}toHumanReadableString(){return this.values.map(e=>l.toHumanReadableString(e)).join(", ")}}class X extends m{params;arrow;body;nodeType="Lambda";constructor(e,t,i){super(),this.params=e,this.arrow=t,this.body=i,this.range=a.of(e,i||t)}isWellFormed(){return this.params.isWellFormed()&&l.isValidToken(this.arrow)&&this.body.isWellFormed()}toHumanReadableString(){let e="((";return this.params&&(e+=l.toHumanReadableString(this.params)),e+=") => ",e+=l.toHumanReadableString(this.body)+")",e}}class ae extends m{openParen;expr;closeParen;nodeType="ExprGroup";constructor(e,t,i){super(),this.expr=t,this.openParen=e,this.closeParen=i,this.range=a.of(e,i||t)}isWellFormed(){return l.isValidToken(this.openParen)&&this.expr.isWellFormed()&&l.isValidToken(this.closeParen)}toHumanReadableString(){return"("+l.toHumanReadableString(this.expr)+")"}}class dt{globalScope=new gt(this);constructor(){}toplevel(){return this.globalScope}fullRange(){return w.INSTANCE.getFullRange()}getContainingNodeAt(e){let t=this.getScopeAt(e);return t.kind==="function"&&t.func.body?.body||null}getScopeAt(e){return this.recursiveGetScopeAt(this.globalScope,e)||this.globalScope}recursiveGetScopeAt(e,t){if(e.range.contains(t)){for(const i of e.children){const s=this.recursiveGetScopeAt(i,t);if(s)return s.isVirtual()?s.parent:s}return e}return null}}class pt{decl;loc;scope;scopeKind;constructor(e,t){this.decl=e,this.loc=e.range,this.scope=t,this.scopeKind=t.kind}}class ee{manager;range;children=[];parent;kind;declarations=new Map;constructor(e){this.parent=e,e&&(this.manager=e.manager,e.children.push(this))}isVirtual(){return this.kind==="block"&&!!this.parent&&this.parent.kind!=="block"}newBlockScope(){return new mt(this)}newFuncScope(){return new ft(this)}pop(){return this.parent?this.parent:this}declare(e,t){if(this.isVirtual()){this.parent.declare(e,t);return}this.declarations.set(e,new pt(t,this))}resolve(e){let t=this;for(;t;){if(t.exists(e))return t.declarations.get(e)||null;t=t.parent}return null}exists(e){return this.declarations.has(e)}clear(){this.declarations.clear(),this.children=[]}}class gt extends ee{kind="global";constructor(e){super(null),this.manager=e,this.range=e.fullRange()}}class ft extends ee{kind="function";func}class mt extends ee{kind="block";block}class wt{input;scope;beginOffsets=[];constructor(e,t){this.scope=e,this.input=t}get offset(){return this.input.seek().range.begin}parseBlock(){let e=[];for(this.scope=this.scope.newBlockScope();!this.input.isEmpty();){const i=this.input.seek();if(i.type===n.EOF||i.type===n.RBrace)break;e.push(this.parseStmt()),this.input.seek()?.type===n.Punctuation&&this.input.seek()?.value===";"&&this.input.consume()}let t=new se(e);return this.scope.range=a.of(t),this.scope.block=t,this.scope=this.scope.pop(),t}eat(e){let t=this.input.seek();return t&&t.type===e?(this.input.consume(),t):null}reportErrorAfter(e,t,i){return new F(t," ",i,a.around(e.range.end))}reportErrorAt(e,t,i){return new F(t,e.value,i,e.range)}reportErrorAtRange(e,t,i){return new F(t,"",i,e.range.clone())}closeScope(e){return e.body?(this.scope.range=a.of(e.body),this.scope.func=e,this.scope=this.scope.pop(),e):(this.scope=this.scope.pop(),e)}closeScopeAndDeclare(e){let t=this.closeScope(e);return e.isWellFormed()&&e.name&&this.scope.declare(e.name.value,e),t}parseBody(){if(this.scope=this.scope.newFuncScope(),this.input.seek()?.type!==n.LBRACE){let s=[new q(null,this.parseExpr())];return new Y(null,new se(s),null)}let e=this.eat(n.LBRACE),t=this.parseBlock(),i=this.eat(n.RBrace);return i?new Y(e,t,i):new Y(e,t,this.reportErrorAt(this.input.seekPrevious(),n.SyntaxError,"'}' expected"))}parseStmt(){let e=this.input.seek();if(e.type==n.Keyword){if(e.value==="let"||e.value==="const"||e.value==="var")return this.parseDeclStmt();if(e.value==="function")return this.parseFuncDecl();if(e.value==="return")return this.parseReturnStmt()}return this.parseExpr()}parseReturnStmt(){let e=this.eat(n.Keyword);return this.input.seek()?.type===n.Punctuation&&this.input.seek()?.value===";"||this.input.seek()?.type===n.EOF||this.input.seek()?.type===n.RBrace||this.input.seekIncludeSpecial()?.type===n.EOL?new q(e,null):new q(e,this.parseExpr())}parseDeclStmt(){let e=this.eat(n.Keyword),t=this.eat(n.Identifier);if(!t)return new U(e,this.reportErrorAfter(e,n.SyntaxError,"Expected identifier"));let i;if(this.input.seek()?.type===n.Equals){let s=this.eat(n.Equals);i=new U(e,t,s,this.parseExpr_L0())}else i=new U(e,t);return this.scope.declare(t.value,i),i}parseFuncDecl(e=!1){let t=this.eat(n.Keyword),i=this.eat(n.Identifier);if(!i&&!e)return new N(t,this.reportErrorAfter(t,n.SyntaxError,"Function name expected"),null,null,null,null);let s=this.eat(n.LPAREN);if(!s)return new N(t,i,this.reportErrorAfter(i||t,n.SyntaxError,"'(' expected"),null,null,null);let o=this.parseParams(),h=this.eat(n.RPAREN);if(!h)return new N(t,i,s,o,this.reportErrorAfter(this.input.seekPrevious(),n.SyntaxError,"')' expected"),null);let u=this.parseBody();return this.closeScopeAndDeclare(new N(t,i,s,o,h,u))}parseParams(){let e=[],t=[];for(;!this.input.isEmpty()&&this.input.seek().type!=n.RPAREN;)if(e.push(this.parseParam()),this.input.seek()?.type===n.Punctuation&&this.input.seek()?.value===",")t.push(this.eat(n.Punctuation));else if(this.input.seek()?.type!==n.RPAREN)t.push(this.reportErrorAfter(this.input.seekPrevious(),n.SyntaxError,"Expected ',' or ')'"));else break;return new H(e,t)}parseParam(){let e=null;this.input.seek()?.type===n.Punctuation&&this.input.seek()?.value==="..."&&(e=this.eat(n.Punctuation));let t=this.eat(n.Identifier);if(t)if(this.input.seek()?.type===n.Equals){if(e)return new y(t,e,this.reportErrorAt(this.input.consume(),n.SyntaxError,"Default value cannot be used with rest parameters"));let i=this.eat(n.Equals),s=this.parseExpr_L0();return new y(t,null,i,s)}else return new y(t,e);else return new y(this.reportErrorAfter(this.input.seekPrevious(),n.SyntaxError,"Parameter name expected"),e)}parseExpr(){let e=[this.parseExpr_L0()],t=[];for(;this.input.seek()?.type===n.Punctuation&&this.input.seek()?.value===",";)t.push(this.eat(n.Punctuation)),e.push(this.parseExpr_L0());return e.length===1?e[0]:new rt(e,t)}parseExpr_L0(){let e=this.input.seek();if(!e)return new m(this.reportErrorAfter(this.input.seekPrevious(),n.SyntaxError,"Expression expected"));if(e.type===n.Punctuation&&e.value==="..."||e.type===n.Keyword&&e.value==="yield"){let i=this.input.consume(),s=this.parseExpr_L1();return new z(i,s)}if(this.input.seek()?.type===n.Identifier&&this.input.seekN(1)?.type===n.Arrow){let i=this.eat(n.Identifier),s=this.eat(n.Arrow),o=this.parseBody();return this.closeScope(new X(new H([new y(i,null)]),s,o))}else if(this.input.seek()?.type===n.LPAREN&&this.input.seekN(1)?.type===n.RPAREN&&this.input.seekN(2)?.type===n.Arrow){this.eat(n.LPAREN),this.eat(n.RPAREN);let i=this.eat(n.Arrow),s=this.parseBody();return this.closeScope(new X(new H([],[]),i,s))}let t=this.parseExpr_L1();if(t.nodeType===C.ExprGroup&&this.input.seek()?.type===n.Arrow){let i,s;if(t.expr.nodeType===C.ExprCommaExpr){let p=t.expr;i=p.values,s=p.commas}else i=[t.expr],s=[];let o=this.eat(n.Arrow),h=this.parseBody(),u=[];for(let p=0;p<i.length;p++){let g=i[p];if(g.nodeType===C.UnaryExpr&&g.operator.value==="..."){let L=g.operator,O=g.operand;O.nodeType!==C.Identifier?u.push(new y(this.reportErrorAfter(L,n.SyntaxError,"Expected identifier"),L)):u.push(new y(O.token,L))}else g.nodeType===C.AssignExpr?u.push(new y(g.left.token,null,g.operator,g.right)):g.nodeType!==C.Identifier?u.push(new y(this.reportErrorAfter(s[p],n.SyntaxError,"Expected identifier"),null)):u.push(new y(g.token,null))}return this.closeScope(new X(new H(u,s),o,h))}if(this.input.seek()?.type===n.Punctuation&&this.input.seek()?.value==="?"){let i=this.eat(n.Punctuation),s=this.parseExpr_L0();if(this.input.seek()?.type!==n.Punctuation||this.input.seek()?.value!==":")return new oe(t,i,s,this.reportErrorAfter(this.input.seekPrevious(),n.SyntaxError,"Expected ':' for ternary operator"),null);let o=this.eat(n.Punctuation),h=this.parseExpr_L0();return new oe(t,i,s,o,h)}if(this.input.seek()?.type===n.EqualOp||this.input.seek()?.type===n.Equals){let i=this.input.consume();return new ut(t,i,this.parseExpr())}return t}parseExpr_L1(){let e=this.parseExpr_L2(),t=this.input.seek();if(t?.type!==n.Operator)return e;if(t?.value==="??"||t?.value==="||"){let i=this.eat(n.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else if(t?.value==="&&"){let i=this.eat(n.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else if(t?.value==="|"){let i=this.eat(n.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else if(t?.value==="^"){let i=this.eat(n.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else if(t?.value==="&"){let i=this.eat(n.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else return e}parseExpr_L2(){let e=this.parseExpr_L3(),t=this.input.seek();for(;t?.type===n.CompareOp||t?.type===n.Keyword;){if(t.type===n.Keyword&&t.value!=="in"&&t.value!=="instanceof")return e;e=new A(e,this.input.consume(),this.parseExpr_L3()),t=this.input.seek()}return e}parseExpr_L3(e=0){let t=this.parseExpr_L4();for(;this.input.seek()?.type===n.Operator;){let i=this.input.consume();if(I.getPrecedence(i.value)<e)break;let s=this.parseExpr_L3(I.isRightAssociative(i.value)?e:e+1);t=new A(t,i,s)}return t}parseExpr_L4(){let e=this.input.seek();if(e?.type===n.Keyword&&e.value==="new"){this.eat(n.Keyword);let i=this.parseExpr_L5();if(this.input.seek()?.type===n.LPAREN){let s=this.eat(n.LPAREN),o=this.parseArgs(),h=this.eat(n.RPAREN);return h?new G(e,i,s,o,h):new G(e,i,s,o,this.reportErrorAfter(this.input.seekPrevious(),n.SyntaxError,"')' expected"))}return new G(e,i,null,null,null)}else if(e?.type===n.UnOperator||e?.type===n.Keyword&&["typeof","void","delete","await"].includes(e.value)||e?.type===n.Operator&&(e.value==="+"||e.value==="-")){let i=this.input.consume(),s=this.parseExpr_L4();return new z(i,s)}else if(e?.type===n.IncrDecrOp){let i=this.input.consume(),s=this.parseExpr_L5();return new z(i,s)}let t=this.parseExpr_L5();for(;;)if(this.input.seek()?.type===n.LPAREN){let i=this.eat(n.LPAREN),s=this.parseArgs(),o=this.eat(n.RPAREN);if(!o)return new K(t,i,s,this.reportErrorAfter(this.input.seekPrevious(),n.SyntaxError,"')' expected"));t=this.parseExpr_L5(new K(t,i,s,o))}else if(this.input.seek()?.type===n.LBRACKET){let i=this.eat(n.LBRACKET),s=this.parseExpr(),o=this.eat(n.RBRACKET);if(!o)return new le(t,i,s,this.reportErrorAt(this.input.seekPrevious(),n.SyntaxError,"']' expected"));t=this.parseExpr_L5(new le(t,i,s,o))}else return t}parseExpr_L5(e){for(e=e||this.parseExpr_L6();this.input.seek()?.type===n.Punctuation&&this.input.seek()?.value===".";){let t=this.eat(n.Punctuation);e=new ht(e,t,this.parseExpr_L6())}return e}parseExpr_L6(){let e=this.input.seek();if(e?.type===n.Keyword)return e.value!=="this"&&e.value!=="super"&&e.value!=="null"&&e.value!=="true"&&e.value!=="false"?new m(this.reportErrorAt(this.input.consume(),n.SyntaxError,"Unexpected keyword")):new at(this.input.consume());if(e?.type===n.LPAREN){let t=this.eat(n.LPAREN),i=this.parseExpr(),s=this.eat(n.RPAREN);return s?new ae(t,i,s):new ae(t,i,this.reportErrorAt(this.input.seekPrevious(),n.SyntaxError,"')' expected"))}else{if(e?.type===n.Identifier)return new $(this.input.consume());if(e?.type===n.Number)return new nt(this.input.consume());if(e?.type===n.String)return new ot(this.input.consume());if(e?.type===n.LBRACKET){let t=this.eat(n.LBRACKET),i=[],s=[];for(;!this.input.isEmpty()&&this.input.seek()?.type!==n.RBRACKET&&(i.push(this.parseExpr_L0()),this.input.seek()?.type===n.Punctuation&&this.input.seek()?.value===",");)s.push(this.eat(n.Punctuation));let o=this.eat(n.RBRACKET);return o?new re(t,i,o,s):new re(t,i,this.reportErrorAt(this.input.seekPrevious(),n.SyntaxError,"']' expected"),s)}else{if(e?.type===n.LBRACE)return this.parseObjectLiteral();if(!e)return new m(this.reportErrorAfter(this.input.seekPrevious(),n.SyntaxError,"Unexpected EOF"))}}return new m(this.reportErrorAt(this.input.consume(),n.SyntaxError,"Unexpected token"))}parseArgs(){let e=[],t=[];for(;!this.input.isEmpty()&&this.input.seek()?.type!==n.RPAREN&&(e.push(this.parseExpr_L0()),this.input.seek()?.type===n.Punctuation&&this.input.seek()?.value===",");)t.push(this.eat(n.Punctuation));return new ct(e,t)}parseObjectLiteral(){let e=this.eat(n.LBRACE),t=[],i=[];for(;!this.input.isEmpty()&&this.input.seek()?.type!==n.RBrace;){let o=this.input.seek();if(o.type!==n.Identifier&&o.type!==n.String)t.push(new M(this.reportErrorAt(this.input.consume(),n.SyntaxError,"Expected identifier or string as key"),null,null));else if(o.type===n.Identifier&&(o.value==="get"||o.value==="set")&&this.input.seekN(1)?.type===n.Identifier){let h=this.input.consume(),u=this.parseFuncDecl();u.keyword=h,t.push(new lt(u))}else if(o.type===n.Identifier||o.type===n.String){let h=this.input.consume(),u=this.input.seek();if(u?.type!==n.Punctuation||u.value!==":")h.type===n.String?t.push(new M(o,this.reportErrorAfter(o,n.SyntaxError,"':' expected"),null)):t.push(new M(h,null,new $(h)));else{this.eat(n.Punctuation);let p=this.parseExpr_L0();t.push(new M(h,u,p))}}if(this.input.seek()?.type!==n.Punctuation||this.input.seek()?.value!==",")break;i.push(this.eat(n.Punctuation))}let s=this.eat(n.RBrace);return s?new ne(e,t,s,i):new ne(e,t,this.reportErrorAfter(this.input.seekPrevious(),n.SyntaxError,"'}' expected"),i)}}class ge{createScopeManager(){return new dt}parse(e,t){return new wt(e,t).parseBlock()}}class Et{name="js-lang-plugin";description="JavaScript Language Plugin for Editor";constructor(){}onRegistered(e,t){t.registerFileTypeAssociation("js",()=>new D,()=>new st,()=>new ge)}}const te=new Z;te.registerPlugin(new Et);te.attach(document.querySelector(".editor-c"));window.editor=te;window.EditorInstance=w;window.js=new D;window.JSParsingUtils=l;window.TextRange=a;window.EditorComponentsData=ue;window.HighlightedToken=f;window.p=r=>console.log(l.toHumanReadableString(parser.parse(null,js.asTokenStream(r))));window.parser=new ge;
