(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class d{static createElement(e,t){function i(c,u,g){switch(u){case".":c.classList.add(g);break;case"#":c.id=g;break}}let s="",n=null,l=null;for(let c of e)[".","#"].includes(c)?(n?i(n,l,s):n=document.createElement(s),l=c,s=""):s+=c;return i(n,l,s),t&&t.appendChild(n),n}static px(e){return`${e}px`}static isInBound(e,t,i,s=5){let n=e.getBoundingClientRect();return n.left-s<=t&&n.right+s>=t&&n.top-s<=i&&n.bottom+s>=i}}class _{view;element}class Te extends _{visualLineCount;lines;edgelines;constructor(e,t){super(),this.view=e,this.element=d.createElement("div.editor-layer.layer-inner",t)}init(){this.visualLineCount=this.view.visualLineCount,this.lines=[];let e=d.createElement("div.editor-line.editor-line-edge",this.element);for(let i=0;i<this.visualLineCount;i++)this.lines.push(d.createElement("div.editor-line.line-"+i,this.element));let t=d.createElement("div.editor-line.editor-line-edge",this.element);this.edgelines=[e,t]}destroy(){}render(){}update(){}renderLine(e,t){this.lines[e].innerHTML="",this.lines[e].append(...t)}renderEdgeLine(e,t){this.edgelines[e].innerHTML="",this.edgelines[e].append(...t)}}class Re extends _{_caret;_input;_blink;constructor(e,t){super(),this.view=e,this.element=d.createElement("div.editor-layer.layer-caret",t),this._caret=d.createElement("div.editor-caret#caret-0",this.element),this._input=d.createElement("input.editor-input",this.element),this._blink=setInterval(()=>this.blink(),750)}blinkReset(){this._caret.classList.remove("blink"),clearInterval(this._blink),this._blink=setInterval(this.blink.bind(this),750)}focus(){this._input.focus()}init(){}setupEventListeners(){this._input.addEventListener("input",e=>{this.view.editor.fire("onInput",e),this.blinkReset()}),this._input.addEventListener("keydown",e=>{this.view.editor.fire("onKeyDown",e)}),this._input.addEventListener("keyup",e=>{this.view.editor.fire("onKeyUp",e)}),this._input.addEventListener("focus",e=>{this.view.editor.fire("onFocus",e),this.blinkReset()}),this._input.addEventListener("blur",e=>{this.view.editor.fire("onBlur",e),this.blinkReset()})}destroy(){}render(){this.update()}update(){this.view.editor.caretModel.forEachCaret(e=>{let t=this.getCaretElement(e);t.style.top=d.px(e.getXY().y),t.style.left=d.px(e.getXY().x)})}getCaretElement(e){return this.element.querySelector(`#caret-${e.id}`)}blink(){this._caret.classList.toggle("blink")}}class Ae{view;caret;selectionStartEl;selectionBodyEl;selectionEndEl;constructor(e,t){this.view=e.view,this.caret=t,this.selectionStartEl=d.createElement("div.editor-selection.selection-start",e.element),this.selectionBodyEl=d.createElement("div.editor-selection.selection-body",e.element),this.selectionEndEl=d.createElement("div.editor-selection.selection-end",e.element)}render(){this.selectionStartEl.style.display="none",this.selectionBodyEl.style.display="none",this.selectionEndEl.style.display="none";let e=this.caret.selectionModel;if(e.isSelectionActive){let t=this.view.editor.logicalToXY(e.getStart()),i=this.view.editor.logicalToXY(e.getEnd()),s=t.x,n=t.y,l=i.x,c=i.y;n>c?([n,c]=[c,n],[s,l]=[l,s]):n===c&&s>l&&([s,l]=[l,s]);let u=(c-n)/this.view.getLineHeight();n===c?(this.selectionStartEl.style.display="block",this.selectionStartEl.style.left=d.px(s),this.selectionStartEl.style.top=d.px(n),this.selectionStartEl.style.width=d.px(l-s)):(this.selectionStartEl.style.display="block",this.selectionStartEl.style.left=d.px(s),this.selectionStartEl.style.top=d.px(n),this.selectionStartEl.style.width=d.px(this.view.getViewWidth()),u>1&&(this.selectionBodyEl.style.display="block",this.selectionBodyEl.style.top=d.px(n+this.view.getLineHeight()),this.selectionBodyEl.style.height=d.px((u-1)*this.view.getLineHeight())),this.selectionEndEl.style.display="block",this.selectionEndEl.style.top=d.px(c),this.selectionEndEl.style.width=d.px(l))}}}class Me extends _{selectionElements=new Map;constructor(e,t){super(),this.view=e,this.element=d.createElement("div.editor-layer.layer-selection",t)}init(){this.view.editor.caretModel.forEachCaret(e=>{this.selectionElements.set(e.id,new Ae(this,e))})}destroy(){}render(){this.update()}update(){this.selectionElements.forEach(e=>e.render())}}class Pe extends _{_activeLine;constructor(e,t){super(),this.view=e,this.element=d.createElement("div.editor-layer.layer-active-line",t),this._activeLine=d.createElement("div.editor-active-line",this.element)}init(){this.view.editor.properties}destroy(){}render(){this.update()}update(){let e=this.view.editor.visualToXY(this.view.editor.getPrimaryCaret().getVisual());this._activeLine.style.top=d.px(e.y)}}class Be{layers_el;text;caret;selection;activeLine;constructor(e){this.layers_el=d.createElement("div.editor-layers",e.view),this.text=new Te(e,this.layers_el),this.caret=new Re(e,this.layers_el),this.selection=new Me(e,this.layers_el),this.activeLine=new Pe(e,this.layers_el)}init(){this.text.init(),this.caret.init(),this.selection.init(),this.activeLine.init()}setupEventListeners(){this.caret.setupEventListeners()}destroy(){this.text.destroy(),this.caret.destroy(),this.selection.destroy(),this.activeLine.destroy(),this.layers_el.remove()}render(){this.text.render(),this.caret.render(),this.selection.render(),this.activeLine.render()}update(){this.text.update(),this.caret.update(),this.selection.update(),this.activeLine.update()}}class Oe{view;element;nDigits=1;lines=[];edgelines=[];constructor(e){this.view=e,this.element=d.createElement("div.editor-gutter",e.view)}init(){this.lines=[];let e=d.createElement("div.editor-gutter-line.editor-line-edge",this.element);for(let i=0;i<this.view.visualLineCount;i++)this.lines.push(d.createElement("div.editor-gutter-line.gutter-line-"+i,this.element));let t=d.createElement("div.editor-gutter-line.editor-line-edge",this.element);this.edgelines=[e,t]}initCSS(){this.update()}update(){this.element.style.setProperty("--editor-gutter-num-size",d.px(this.nDigits*this.view.getCharSize()))}destroy(){}renderLine(e,t){this.lines[e].innerHTML="",this.lines[e].append(...t)}renderEdgeLine(e,t){this.edgelines[e].innerHTML="",this.edgelines[e].append(...t)}}var m=(r=>(r.NUM0="0",r.NUM1="1",r.NUM2="2",r.NUM3="3",r.NUM4="4",r.NUM5="5",r.NUM6="6",r.NUM7="7",r.NUM8="8",r.NUM9="9",r.A="a",r.B="b",r.C="c",r.D="d",r.E="e",r.F="f",r.G="g",r.H="h",r.I="i",r.J="j",r.K="k",r.L="l",r.M="m",r.N="n",r.O="o",r.P="p",r.Q="q",r.R="r",r.S="s",r.T="t",r.U="u",r.V="v",r.W="w",r.X="x",r.Y="y",r.Z="z",r.ESCAPE="Escape",r.BACKSPACE="Backspace",r.DELETE="Delete",r.ENTER="Enter",r.TAB="Tab",r.ARROW_UP="ArrowUp",r.ARROW_DOWN="ArrowDown",r.ARROW_LEFT="ArrowLeft",r.ARROW_RIGHT="ArrowRight",r.PAGE_UP="PageUp",r.PAGE_DOWN="PageDown",r.HOME="Home",r.END="End",r.SPACE=" ",r.COMMA=",",r.PERIOD=".",r.SEMICOLON=";",r.QUOTE="'",r.SLASH="/",r.BACKSLASH="\\",r.DASH="-",r.EQUALS="=",r.LEFT_BRACKET="[",r.RIGHT_BRACKET="]",r.QUESTION_MARK="?",r.TILDE="~",r.CAPS_LOCK="CapsLock",r.INSERT="Insert",r.LeftClick="LClick",r.LeftDoubleClick="LDoubleClick",r.LeftTripleClick="LTripleClick",r.MiddleClick="MiddleClick",r.RightClick="RClick",r.RightDoubleClick="RDoubleClick",r))(m||{});class E{static INSTANCE;isCtrlPressed=!1;isAltPressed=!1;isShiftPressed=!1;isMouseDown=!1;isDragging=!1;static get isCtrlPressed(){return this.getInstance().isCtrlPressed}static get isAltPressed(){return this.getInstance().isAltPressed}static get isShiftPressed(){return this.getInstance().isShiftPressed}static get isMouseDown(){return this.getInstance().isMouseDown}static get isDragging(){return this.getInstance().isDragging}static getInstance(){return this.INSTANCE||(this.INSTANCE=new E),this.INSTANCE}set(e){this.isCtrlPressed=e.ctrlKey??!1,this.isAltPressed=e.altKey??!1,this.isShiftPressed=e.shiftKey??!1,this.isMouseDown=e.button!==void 0&&e.button===0}setIsDragging(e){this.isDragging=e}clear(){this.isCtrlPressed=!1,this.isAltPressed=!1,this.isShiftPressed=!1,this.isMouseDown=!1}}class j{onAttached(e,t){}onBlur(e,t){}onFocus(e,t){}onInput(e,t){}onKeyDown(e,t){}onKeyUp(e,t){}onMouseDown(e,t){}onMouseMove(e,t){}onMouseUp(e,t){}onRender(e){}onScroll(e,t){}}class He{onSrLoaded(e,t,i,s){}onCaretRemove(e,t){}onCaretMove(e,t,i,s){}}class Ie{onSrLoaded(e,t,i,s){}onAttached(e,t){}onRender(e){}onInput(e,t){}onKeyDown(e,t){}onKeyUp(e,t){}onMouseDown(e,t){}onMouseMove(e,t){}onMouseUp(e,t){}onScroll(e,t){}onFocus(e,t){}onBlur(e,t){}onCaretMove(e,t,i,s){}onCaretRemove(e,t){}onRegistered(e,t){}}class Fe{visualListeners=[];editorListeners=[];langListeners={};conditionalListeners=new Map;keybindingListeners=new Map;addVisualEventListener(e){this.visualListeners.push(e)}addEditorEventListener(e){this.editorListeners.push(e)}addLangEventListener(e,t){this.langListeners[e]||(this.langListeners[e]=[]),this.langListeners[e].push(t)}addKeybindingListener(e,t){this.keybindingListeners.set(e,t)}removeVisualEventListener(e){this.visualListeners.splice(this.visualListeners.indexOf(e),1)}fireKeybinding(e,t){for(let[i,s]of this.keybindingListeners.entries())this.matches(i,e)&&s.apply(null,[t,e])}fireMouseKeybinding(e,t){for(let[i,s]of this.keybindingListeners.entries())this.matches(i,e)&&this.fireMouseKeybindingFor(s,t,e,i);for(let[i,{listener:s,condition:n}]of this.conditionalListeners.entries())this.matches(i,e)&&n(t,e)&&this.fireMouseKeybindingFor(s,t,e,i)}fire(e,...t){for(const i of this.visualListeners){const s=i[e];s&&s.apply(i,t)}for(const i of this.editorListeners){const s=i[e];s&&s.apply(i,t)}}fireLangEvent(e,t,...i){const s=this.langListeners[e];if(s)for(const n of s){const l=n[t];l&&l.apply(n,i)}}addConditionalEventListener(e,t,i){this.conditionalListeners.set(e,{listener:t,condition:i})}fireMouseKeybindingFor(e,t,i,s){i.button===0?s.key===m.LeftClick?e.apply(null,[t,i]):s.key===m.LeftDoubleClick&&i.detail===2?e.apply(null,[t,i]):s.key===m.LeftTripleClick&&i.detail===3&&e.apply(null,[t,i]):i.button===1&&s.key===m.MiddleClick?e.apply(null,[t,i]):s.key===m.RightClick?e.apply(null,[t,i]):s.key===m.RightDoubleClick&&i.detail===2&&e.apply(null,[t,i])}matches(e,t){return(!("key"in t)||t.key===e.key)&&(e.ctrl!==void 0?t.ctrlKey===e.ctrl:!0)&&(e.alt!==void 0?t.altKey===e.alt:!0)&&(e.shift!==void 0?t.shiftKey===e.shift:!0)}}const De={view:{width:600,height:400,gutterWidth:60,lineHeight:25,caretHeight:20,fontSize:16,rootBgColor:"#1e1f24",rootBorderColor:"#93969f",gutterColor:"#93969f",caretColor:"#ffffff",selectionColor:"#214283",activeLineColor:"#2b2e38"}};class Ne{view;scrollX;scrollY;constructor(e,t,i){this.view=e,this.scrollX=t,this.scrollY=i}get scrollYLines(){return Math.ceil(this.scrollY/this.view.getLineHeight())}set scrollYLines(e){this.scrollY=e*this.view.getLineHeight()}get scrollXChars(){return Math.ceil(this.scrollX/this.view.getCharSize())}set scrollXChars(e){this.scrollX=e*this.view.getCharSize()}get scrollYOffset(){return this.scrollY%this.view.getLineHeight()}get scrollXOffset(){return this.scrollX%this.view.getCharSize()}}var Ee=(r=>(r[r.Smooth=0]="Smooth",r[r.Instant=1]="Instant",r))(Ee||{});class O{static componentIdCounter=0;static actionIdCounter=0;static components=new Map;static popups=new Map;static getComponentIDFor(e){const t=`${e.name}-${this.componentIdCounter++}`;return this.components.set(t,e),t}static getComponentById(e){return this.components.get(e)}static getActionIdFor(e){return`${this.actionIdCounter++}-${e}`}static getPopup(e){return console.log(this.popups.get(e.id)),this.popups.has(e.id)||this.popups.set(e.id,e.createPopup()),this.popups.get(e.id)}static registerPopup(e,t){return this.popups.set(e.id,t),this.getComponentIDFor(t)}}class We{constructor(e){this.view=e}name="h-scrollbar";id=O.getComponentIDFor(this);scrollbar;handle;isDragging=!1;startX=0;startLeft;onDestroy(e){}onRender(){this.scrollbar=d.createElement("div.scrollbar.h-scroll",this.view.layers.layers_el),this.handle=d.createElement("div.scrollbar-handle",this.scrollbar),this.handle.style.width="0",this.scrollbar.addEventListener("mousedown",e=>{this.clicked(e),e.preventDefault(),e.stopPropagation()}),this.handle.addEventListener("mousedown",e=>{this.isDragging=!0,this.startX=e.clientX,this.startLeft=parseFloat(this.handle.style.left)||0,e.preventDefault(),e.stopPropagation()}),document.addEventListener("mousemove",e=>{this.isDragging&&this.drag(e)}),document.addEventListener("mouseup",e=>{this.isDragging=!1})}update(){const e=this.view.scroll.scrollX,t=this.scrollbar.getBoundingClientRect().width,i=this.view.getMaxWidth();if(i-t<=3){this.handle.style.width="0";return}const s=Math.max(t/i*t,20),n=e/i*t;this.handle.style.width=d.px(s),this.handle.style.left=d.px(n)}drag(e){const t=e.clientX-this.startX,i=this.scrollbar.clientWidth,s=this.handle.clientWidth,n=i-s;let l=Math.min(Math.max(this.startLeft+t,0),n);this.handle.style.left=`${l}px`;const c=this.view.getMaxWidth(),u=this.scrollbar.getBoundingClientRect().width,g=c-u,w=l/n;this.view.scrollBy(w*g-this.view.scroll.scrollX,0)}clicked(e){const t=this.scrollbar.getBoundingClientRect(),i=e.clientY-t.left,s=this.scrollbar.clientWidth,n=this.handle.clientWidth,l=s-n;let c=Math.min(Math.max(i-n/2,0),l);const u=this.view.getMaxWidth(),g=this.scrollbar.getBoundingClientRect().width,w=u-g,k=c/l;this.view.scrollBy(k*w-this.view.scroll.scrollX,0)}}class Ve{constructor(e){this.view=e}name="v-scrollbar";id=O.getComponentIDFor(this);scrollbar;handle;isDragging=!1;startY=0;startTop;onDestroy(e){}onRender(){this.scrollbar=d.createElement("div.scrollbar.v-scroll",this.view.layers.layers_el),this.handle=d.createElement("div.scrollbar-handle",this.scrollbar),this.handle.style.height="0",this.scrollbar.addEventListener("mousedown",e=>{this.clicked(e),e.preventDefault(),e.stopPropagation()}),this.handle.addEventListener("mousedown",e=>{this.isDragging=!0,this.startY=e.clientY,this.startTop=parseFloat(this.handle.style.top)||0,e.preventDefault(),e.stopPropagation()}),document.addEventListener("mousemove",e=>{this.isDragging&&this.drag(e)}),document.addEventListener("mouseup",e=>{this.isDragging=!1})}update(){const e=this.view.scroll.scrollY,t=this.scrollbar.getBoundingClientRect().height,i=this.view.getMaxHeight();if(i-t<=3){this.handle.style.height="0";return}const s=Math.max(t/i*t,20),n=e/i*t;this.handle.style.height=d.px(s),this.handle.style.top=d.px(n)}drag(e){const t=e.clientY-this.startY,i=this.scrollbar.clientHeight,s=this.handle.clientHeight,n=i-s;let l=Math.min(Math.max(this.startTop+t,0),n);this.handle.style.top=`${l}px`;const c=this.view.getMaxHeight(),u=this.scrollbar.getBoundingClientRect().height,g=c-u,w=l/n;this.view.scrollBy(0,w*g-this.view.scroll.scrollY)}clicked(e){const t=this.scrollbar.getBoundingClientRect(),i=e.clientY-t.top,s=this.scrollbar.clientHeight,n=this.handle.clientHeight,l=s-n;let c=Math.min(Math.max(i-n/2,0),l);const u=this.view.getMaxHeight(),g=this.scrollbar.getBoundingClientRect().height,w=u-g,k=c/l;this.view.scrollBy(0,k*w-this.view.scroll.scrollY)}}class _e{constructor(e){this.view=e,this.hScrollBar=new We(this.view),this.vScrollBar=new Ve(this.view)}hScrollBar;vScrollBar;getHorizontalScrollBar(){return this.hScrollBar}getVerticalScrollBar(){return this.vScrollBar}render(){this.hScrollBar.onRender(),this.vScrollBar.onRender()}update(){this.hScrollBar.update(),this.vScrollBar.update()}}function je(r){let e=d.createElement("div.editor-sizer",r.view);return e.innerHTML="a",()=>e.getBoundingClientRect().width}class Ye{editor;componentRenderer;view;scroll;gutter;layers;scrollBar;getCharSize;getLineHeight;getViewWidth;getViewHeight;visualLineCount;visualCharCount;popups=[];lines;isDirty=!0;constructor(e){this.editor=e,this.componentRenderer=e.getComponentManager().getRenderer(),this.editor.addVisualEventListener(new class extends j{onBlur(t,i){t.root.classList.remove("focused")}onFocus(t,i){t.root.classList.add("focused")}onMouseDown(t,i){i.preventDefault(),t.view.focus()}onMouseMove(t,i){for(let s of t.view.popups)s.isInBound(i.x,i.y)||s.close()}onScroll(t,i){i.preventDefault(),t.view.scrollBy(i.deltaX,i.deltaY),t.view.resetBlink()}}),this.editor.addEditorEventListener(new class extends He{onCaretMove(t,i,s,n){t.view.ensureCaretVisible()}})}onAttached(e,t){this.view=d.createElement("div.editor-view",t),this.scroll=new Ne(this,0,0),this.gutter=new Oe(this),this.layers=new Be(this),this.scrollBar=new _e(this),this.initCSS(),this.setupEventListeners(),this.gutter.init(),this.layers.init(),this.scrollBar.render()}setCSSProperties(e,t){for(const[i,s]of Object.entries(t))e.style.setProperty(i,s)}focus(){this.layers.caret.focus()}scrollBy(e,t){let i=this.scroll.scrollX+e/2;i<0?this.scroll.scrollX=0:i>(this.editor.getOpenedDocument().getMaxLengthLine()-this.visualCharCount+2)*this.getCharSize()?this.scroll.scrollX=Math.max(0,(this.editor.getOpenedDocument().getMaxLengthLine()-this.visualCharCount+2)*this.getCharSize()):this.scroll.scrollX=i;let s=this.scroll.scrollY+t;s<0?this.scroll.scrollY=0:s>(this.editor.getLineCount()-this.visualLineCount+2)*this.getLineHeight()?this.scroll.scrollY=Math.max(0,(this.editor.getLineCount()-this.visualLineCount+2)*this.getLineHeight()):this.scroll.scrollY=s,this.triggerRepaint()}scrollIntoView(e,t){let i=this.scrollIntoViewAlong(e.col,this.scroll.scrollXChars,this.scroll.scrollXChars+this.visualCharCount-1),s=this.scrollIntoViewAlong(e.row,this.scroll.scrollYLines,this.scroll.scrollYLines+this.visualLineCount-1);i!==null&&(this.scroll.scrollX=i*this.getCharSize()),s!==null&&(this.scroll.scrollY=s*this.getLineHeight()),this.triggerRepaint()}ensureCaretVisible(){this.offScreen(this.editor.getPrimaryCaret().getVisual())&&this.scrollIntoView(this.editor.getPrimaryCaret().getLogical(),Ee.Smooth)}getMaxHeight(){return Math.max(this.editor.getLineCount()+2,this.visualLineCount)*this.getLineHeight()}getMaxWidth(){return Math.max(this.editor.getOpenedDocument().getMaxLengthLine(),this.visualCharCount)*this.getCharSize()}getRelativePos(e){let t=e.clientX-this.layers.layers_el.getBoundingClientRect().left,i=e.clientY-this.layers.layers_el.getBoundingClientRect().top;return[t,i]}render(){this.isDirty&&(this.isDirty=!1,this.repaint()),this.update()}repaint(){let e=this.scroll.scrollYLines,t=this.scroll.scrollYOffset,i=this.lines=this.componentRenderer.renderNLines(e,this.visualLineCount);for(let s=0;s<this.visualLineCount;s++)this.layers.text.renderLine(s,i[s].content),this.gutter.renderLine(s,i[s].gutter);if(this.gutter.nDigits=Math.floor(Math.log10(this.editor.getLineCount()))+1,t){if(e>0){let s=this.componentRenderer.renderLine(e-1);this.layers.text.renderEdgeLine(0,s.content),this.gutter.renderEdgeLine(0,s.gutter),this.lines.unshift(s)}if(e+this.visualLineCount<this.editor.getLineCount()){let s=this.componentRenderer.renderLine(e+this.visualLineCount);this.layers.text.renderEdgeLine(1,s.content),this.gutter.renderEdgeLine(1,s.gutter),this.lines.push(s)}}this.setCSSProperties(this.view,{"--editor-scroll-offsetY":d.px(t||this.getLineHeight())}),this.setCSSProperties(this.view,{"--editor-scroll-x":d.px(this.scroll.scrollX)})}triggerRepaint(){this.isDirty=!0}update(){this.gutter.update(),this.layers.update(),this.scrollBar.update()}destroy(){this.gutter.destroy(),this.layers.destroy(),this.view.remove()}addPopup(e){let t=e.render(this);this.layers.layers_el.appendChild(t),this.popups.push(e)}showPopup(e,t,i){let s=e.element;e.show();let n=this.layers.layers_el.getBoundingClientRect().left,l=this.layers.layers_el.getBoundingClientRect().top,c=t-n,u=Math.ceil((i-l)/this.getLineHeight())*this.getLineHeight();s.style.left=d.px(c),s.style.top=d.px(u)}updateTextLayer(){this.layers.text.update(),this.layers.activeLine.update()}updateCaret(){this.layers.caret.update()}updateSelection(){this.layers.selection.update()}updateActiveLine(){this.layers.activeLine.update()}updateGutter(){this.gutter.update()}resetBlink(){this.layers.caret.blinkReset()}offScreen(e){let t=this.editor.visualToXY(e);return t.x<0||t.x>=this.getViewWidth()||t.y<0||t.y>=this.getViewHeight()}scrollIntoViewAlong(e,t,i){if(e>t&&e<i)return null;if(e<=t)return Math.max(0,e-2);{let s=i-t;return e+1>=this.editor.getLineCount()?Math.max(0,this.editor.getLineCount()-s):Math.max(0,e-s)}}setupEventListeners(){this.view.addEventListener("mousedown",e=>this.editor.fire("onMouseDown",e)),this.view.addEventListener("mouseup",e=>this.editor.fire("onMouseUp",e)),this.view.addEventListener("mousemove",e=>this.editor.fire("onMouseMove",e)),this.view.addEventListener("wheel",e=>this.editor.fire("onScroll",e)),this.view.addEventListener("contextmenu",e=>e.preventDefault()),this.layers.setupEventListeners()}initCSS(){const e=this.editor.properties.view||(this.editor.properties.view={});function t(i){return e[i]||(e[i]=De.view[i])}this.setCSSProperties(this.editor.root,{"--editor-width":d.px(t("width")),"--editor-height":d.px(t("height")),"--editor-root-bg":t("rootBgColor"),"--editor-root-border-color":t("rootBorderColor"),"--editor-font-size":d.px(t("fontSize")),"--editor-line-height":d.px(t("lineHeight")),"--editor-gutter-width":d.px(t("gutterWidth")),"--editor-caret-height":d.px(t("caretHeight")),"--editor-gutter-color":t("gutterColor"),"--editor-caret-color":t("caretColor"),"--editor-selection-color":t("selectionColor"),"--editor-active-line-color":t("activeLineColor")}),this.getCharSize=je(this),this.getLineHeight=()=>e.lineHeight,this.getViewWidth=()=>e.width,this.getViewHeight=()=>e.height,this.visualLineCount=Math.floor(e.height/this.getLineHeight()),setTimeout(()=>{this.visualCharCount=Math.floor(this.layers.layers_el.getBoundingClientRect().width/this.getCharSize())},100),this.setCSSProperties(this.view,{"--editor-scroll-offsetY":d.px(this.getLineHeight())}),this.gutter.initCSS()}}class Ue{name;files;constructor(e,t){this.name=e,this.files=t||[]}static singleFileProject(e){return new this("unnamed-project",[e])}addFile(e){for(let t of this.files)if(t.path===e.path)return;this.files.push(e)}}class Xe{name;path;type;constructor(e,t,i){this.name=e||"temp-file",this.path=t?t+"/"+this.name:"",this.type=i||"js"}read(){return this.path==="",""}getContentAsString(){return""}}class qe extends Ie{name;description}class ze{editor;plugins;lexerProviderMap=new Map;highlighterProviderMap=new Map;parserProviderMap=new Map;constructor(e){this.editor=e,this.plugins={}}register(e){this.plugins[e.name]=e,e.onRegistered(this.editor,this),this.editor.addEditorEventListener(e),this.editor.addVisualEventListener(e)}registerFileTypeAssociation(e,t,i,s){this.lexerProviderMap.set(e,t),i&&this.highlighterProviderMap.set(e,i),s&&this.parserProviderMap.set(e,s)}getLexerForFileType(e){const t=this.lexerProviderMap.get(e);if(t)return t()}getHighlighterForFileType(e){const t=this.highlighterProviderMap.get(e);if(t)return t()}getParserForFileType(e){const t=this.parserProviderMap.get(e);if(t)return t()}}class y{static _isLocked=!1;static waiting=[];static _count=0;static _Instance=null;static get Instance(){if(!y._Instance)throw new Error("Editor instance not acquired yet. Please call EditorInstance.acquire(editor) first.");return y._Instance}static async acquireAsync(e){if(!this._Instance&&!this._isLocked)this._isLocked=!0,this._Instance=e,this._count=0;else{if(this._Instance===e){this._count++;return}await new Promise(t=>this.waiting.push([e,t]))}}static release(){if(this._count!==0){this._count--;return}if(!this.waiting.length)this._isLocked=!1,this._Instance=null;else{const[e,t]=this.waiting.shift();this._Instance=e,t()}}static async with(e,t){await this.acquireAsync(e),t(),this.release()}static acquire(e){if(!this.waitForFlagSync())throw new Error("Error: Couldn't acquire editor instance in time. This is probably caused by an abnormal delay in an asynchronously running operation.");this._Instance=e}static waitForFlagSync(e=2e3){if(!this._Instance&&!this._isLocked)return!0;console.warn(`Warning: Editor instance is already acquired. Waiting for it to be released for a maximum of ${e}ms...`);const t=Date.now();for(;Date.now()-t<e;)if(!this._Instance&&!this._isLocked)return!0;return!1}}class R{static _INSTANCES=new Map;ranges=new Set;rangesRegistry=new FinalizationRegistry(e=>{this.ranges.delete(e)});static getInstance(){return R._INSTANCES.has(y.Instance.id)||R._INSTANCES.set(y.Instance.id,new R),R._INSTANCES.get(y.Instance.id)}add(e){const t=new WeakRef(e);this.ranges.add(t),this.rangesRegistry.register(e,t)}updateRanges(e,t){for(const i of this.ranges){const s=i.deref();if(!s){this.ranges.delete(i);continue}s.begin>e&&(s.begin+=t),s.end>=e&&(s.end+=t)}}}class h{isTracked;begin;end;constructor(e,t,i=!1){i&&R.getInstance().add(this),this.isTracked=i,this.begin=e,this.end=t}static of(e,t){if(Array.isArray(e)){let i=e.filter(s=>s!==null);return i.length==1?i[0].range.clone():i.length==0?new h(0,0):new h(i[0].range.begin,i[i.length-1].range.end,!0)}return t?new h(e.range.begin,t.range.end,!0):e.range.clone()}static around(e){return new h(e,e+1,!0)}static tracked(e,t){return new h(e,t,!0)}moveBy(e){this.begin+=e,this.end+=e}overlaps(e){return this.begin<=e.end&&this.end>=e.begin}contains(e){return e instanceof h?this.begin<=e.begin&&this.end>=e.end:this.begin<=e&&this.end>=e}clone(){return new h(this.begin,this.end,this.isTracked)}cloneNotTracked(){return new h(this.begin,this.end,!1)}}var T=(r=>(r[r.LEFT=0]="LEFT",r[r.RIGHT=1]="RIGHT",r[r.UNKNOWN=2]="UNKNOWN",r))(T||{});class Ge{editor;caret;isSelectionActive;startOffset;endOffset=null;constructor(e){this.editor=e.editor,this.caret=e,this.isSelectionActive=!1}getDirection(){return!this.isSelectionActive||this.startOffset===null||this.endOffset===null?2:this.startOffset<this.endOffset?1:0}setStart(e){this.startOffset=this.editor.logicalToOffset(e)}setEnd(e){this.endOffset=this.editor.logicalToOffset(e)}setActive(e){this.isSelectionActive=e}onCaretMove(){if(!E.isShiftPressed&&!E.isDragging)return this.setStart(this.caret.getLogical()),this.clear();this.setEnd(this.caret.getLogical()),this.isSelectionActive||this.setActive(!0)}getStartOffset(){return this.startOffset}getStart(){let e=this.startOffset;return e===null?this.caret.getLogical():this.editor.offsetToLogical(e)}getEndOffset(){return this.endOffset}getEnd(){let e=this.endOffset;return e===null?this.caret.getLogical():this.editor.offsetToLogical(e)}getSelectionLength(){return this.isSelectionActive?Math.abs(this.startOffset-this.endOffset):0}select(e,t){this.startOffset=e,this.endOffset=t,this.isSelectionActive=!0}clear(){this.setStart(this.caret.getLogical()),this.isSelectionActive=!1,this.endOffset=null}}class M{__brand="logical";col;row;constructor(e,t){this.col=e,this.row=t}is(e){return this.row===e.row&&this.col===e.col}}class ee{__brand="visual";col;row;constructor(e,t){this.col=e,this.row=t}isAfter(e){return this.row>e.row||this.row===e.row&&this.col>e.col}is(e){return this.row===e.row&&this.col===e.col}}class ue{id=0;caretModel;editor;isPrimary;vertMovementPos=0;selectionModel;myLogical;myVisual;constructor(e,t){this.caretModel=e,this.editor=e.editor,this.isPrimary=t,this.myLogical=new M(0,0),this.myVisual=new ee(0,0),this.selectionModel=new Ge(this)}getSelectionModel(){return this.selectionModel}getLogical(){return this.myLogical}getVisual(){return this.myVisual}getOffset(){return this.editor.logicalToOffset(this.myLogical)}getXY(){return this.editor.logicalToXY(this.getLogical())}setVertMovementPos(){this.vertMovementPos=Math.max(this.vertMovementPos,this.myLogical.col)}onCaretMove(e){this.editor.fire("onCaretMove",this,e,this.myLogical),this.selectionModel.onCaretMove()}moveToOffset(e){this.moveToLogical(this.editor.offsetToLogical(e))}moveToLogical(e){let t=this.myLogical;this.myLogical=e,this.myVisual=this.editor.logicalToVisual(e),this.onCaretMove(t)}shift(e=1){this.moveToOffset(this.getOffset()+e),this.vertMovementPos=0}remove(){this.editor.fire("onCaretRemove",this)}}class $e{editor;carets=[];constructor(e){this.editor=e,this.carets.push(new ue(this,!0))}getPrimary(){return this.carets.find(e=>e.isPrimary)}addCaret(e){const t=new ue(this,!1);return this.carets.push(t),t}forEachCaret(e){for(const t of this.carets)e(t)}shift(e){this.forEachCaret(t=>t.shift(e))}removeAll(){for(let e=0;e<this.carets.length;e++)this.carets[e].isPrimary||(this.carets[e].remove(),this.carets.splice(e,1),e--)}}class p{isError=!1;type;value;range;isSpecial;isComment;constructor(e,t,i,s=!1,n=!1){this.type=e,this.value=t,this.range=i,this.isSpecial=s,this.isComment=n}}class I extends p{isError=!0;msg;constructor(e,t,i,s){super(e,t,s,!1,!1),this.msg=i}}class Ke{src;index=0;followupError=null;constructor(e){this.src=e}consume(){return this.index>=this.src.length?null:this.src[this.index++]}seek(){return this.index>=this.src.length?null:this.src[this.index]}seekNext(){return this.src[this.index+1]||null}find(e){return this.src.indexOf(e,this.index+1)}slice(e){return this.src.slice(this.index+1,e)}jump(e){this.index+=e}length(){return this.src.length-this.index}isEmpty(){return this.index>=this.src.length}clearError(){let e=this.followupError;return this.followupError=null,e}}class Le{skipSpecial=!0;skipComments=!0;static of(...e){return new se(e)}}class se extends Le{tokens;index=0;constructor(e){super(),this.tokens=e}clone(){return new se(this.tokens.slice())}isEmpty(){return this.index>=this.tokens.length}seek(){return this.seekN(0)}seekIncludeSpecial(){return this.tokens[this.index]}seekN(e){let t,i=this.index+e;do t=this.tokens[i],i+=Math.sign(e)||1;while(t&&(this.skipComments&&t.isComment||this.skipSpecial&&t.isSpecial));return t||null}seekPrevious(){return this.seekN(-1)}consume(){const e=this.seek();return e&&this.index++,e}exhaust(){let e=this.index;for(;!this.isEmpty();)this.consume();return this.tokens.slice(e)}includeComments(){this.skipComments=!1}includeSpecial(){this.skipSpecial=!1}}class Y extends Le{lexer;src;tokens=[];index=0;computed=0;constructor(e,t,i=!0){super(),this.lexer=e,this.src=new Ke(t),this.skipSpecial=i}clone(){const e=new Y(this.lexer,this.src.src,this.skipSpecial);return e.index=this.index,e.computed=this.computed,e.tokens=[...this.tokens],this.skipComments||e.includeComments(),e}isEmpty(){return this.index>=this.tokens.length&&this.src.isEmpty()}consume(){const e=this.seek();return this.index++,this.computed--,e}seek(){return this.seekN(0)}seekIncludeSpecial(){let e=this.skipSpecial;this.skipSpecial=!1;let t=this.seek();return this.skipSpecial=e,t}seekN(e){for(;this.computed<=e;)this.compute();return this.tokens[this.index+e]||null}seekPrevious(){return this.seekN(-1)}exhaust(){let e=[];for(;!this.isEmpty();)e.push(this.consume());return e}includeComments(){this.skipComments=!1}includeSpecial(){this.skipSpecial=!1}compute(){const e=this.lexer.tokenize(this.src);if(e){if(this.skipSpecial&&e.isSpecial)return this.compute();if(this.skipComments&&e.isComment)return this.compute();this.computed++,this.tokens.push(e)}}}class Qe{EOF;compiledMatchers;specialChars=[];comments=[];setRules(e){this.compiledMatchers=e.map(({matcher:t,type:i,getValue:s})=>({matcher:new RegExp(t.source,"y"),type:i,getValue:s}))}setEOF(e){this.EOF=e}setSpecial(...e){this.specialChars=e}setComments(...e){this.comments=e}tokenize(e){if(e.isEmpty())return new p(this.EOF,"",h.tracked(e.index,e.index),!1,!1);for(const t of this.compiledMatchers){t.matcher.lastIndex=e.index;const i=t.matcher.exec(e.src);if(i&&(e.jump(i[0].length),t.type!==null)){const s=t.getValue?t.getValue(i[0]):i[0],n=this.specialChars.includes(t.type),l=this.comments.includes(t.type);return new p(t.type,s,h.tracked(e.index-i[0].length,e.index),n,l)}}throw"Unexpected token at index "+e.index+" in source: "+e.src}}class Ze extends Qe{constructor(){super(),this.setRules([{matcher:/\r\n|\n|\r/,type:"EOL"},{matcher:/([^\r\n]+)/,type:"Default"}]),this.setEOF("EOF"),this.setSpecial("EOL")}asTokenStream(e){return new Y(this,e)}}class x{id;name;description;keybinding;constructor(){this.id=O.getActionIdFor(this.name)}}class Je extends x{name="Delete";description="Delete the selected text or the character after the caret.";keybinding={key:m.DELETE,ctrl:!1,alt:!1,shift:!1};run(e,t){e.caretModel.forEachCaret(i=>{i.selectionModel.isSelectionActive?e.deleteSelection(i):e.deleteAt(i.getOffset())}),e.view.resetBlink()}}class B{static DELIMITER=/[\s.,;:!?(){}\[\]<>/*-+%&]/;static getOffsetToPreviousWord(e,t,i){if(t<=0)return 0;let s=t,n=e.getCharAt(t-1);if(i.test(n)){for(;t>0&&e.getCharAt(t-1)===n;)t--;if(n!==" ")return t-s}for(;t>0&&!i.test(e.getCharAt(t-1));)t--;return t-s}static getOffsetToNextWord(e,t,i){if(t>=e.getTotalDocumentLength())return 0;let s=t,n=e.getCharAt(t);if(i.test(n)){for(;t<e.getTotalDocumentLength()&&e.getCharAt(t)===n;)t++;if(n!==" ")return t-s}for(;t<e.getTotalDocumentLength()&&!i.test(e.getCharAt(t));)t++;return t-s}}class et extends x{name="Backspace";description="Delete the selected text or the character at the caret position.";keybinding={key:m.BACKSPACE,ctrl:!1,alt:!1,shift:!1};run(e,t){e.caretModel.forEachCaret(i=>{i.getSelectionModel().isSelectionActive?e.deleteSelection(i):(i.shift(-1),e.deleteAt(i.getOffset()))}),e.view.resetBlink()}}class tt extends x{name="Ctrl+Backspace";description="Delete the word before the caret position.";keybinding={key:m.BACKSPACE,ctrl:!0,alt:!1,shift:!1};run(e,t){e.caretModel.forEachCaret(i=>{if(i.getSelectionModel().isSelectionActive)e.deleteSelection(i);else{const s=B.getOffsetToPreviousWord(e.getOpenedDocument(),i.getOffset(),B.DELIMITER);i.shift(s),e.deleteAt(i.getOffset(),-s)}e.view.triggerRepaint()}),e.view.resetBlink()}}function U(r,e){let t=r.selectionModel.startOffset;r.selectionModel.clear(),e&&r.moveToOffset(t)}class it extends x{name="MoveCaretLeft";description="Move the caret to the left by one character.";keybinding={key:m.ARROW_LEFT,ctrl:!1,alt:!1};run(e,t){e.caretModel.forEachCaret(i=>{let s=i.selectionModel.getDirection();!t.shiftKey&&s!==T.UNKNOWN?U(i,s===T.RIGHT):i.shift(-1)}),e.view.resetBlink()}}class st extends x{name="MoveCaretRight";description="Move the caret to the right by one character.";keybinding={key:m.ARROW_RIGHT,ctrl:!1,alt:!1};run(e,t){e.caretModel.forEachCaret(i=>{let s=i.selectionModel.getDirection();!t.shiftKey&&s!==T.UNKNOWN?U(i,s===T.LEFT):i.shift(1)}),e.view.resetBlink()}}class rt extends x{name="MoveCaretUp";description="Move the caret up one line.";keybinding={key:m.ARROW_UP,ctrl:!1,alt:!1};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{!t.shiftKey&&i.selectionModel.getDirection()!==T.UNKNOWN&&U(i,i.selectionModel.getDirection()===T.RIGHT);let s=i.getLogical();if(s.row===0)return;i.setVertMovementPos();let n=new M(Math.min(e.getOpenedDocument().getLineLength(s.row-1),i.vertMovementPos),s.row-1);i.moveToLogical(n)})}}class nt extends x{name="MoveCaretDown";description="Move the caret down one line.";keybinding={key:m.ARROW_DOWN,ctrl:!1,alt:!1};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{!t.shiftKey&&i.selectionModel.getDirection()!==T.UNKNOWN&&U(i,i.selectionModel.getDirection()===T.LEFT);let s=i.getLogical();if(s.row>=e.getLineCount()-1)return;i.setVertMovementPos();let n=new M(Math.min(e.getOpenedDocument().getLineLength(s.row+1),i.vertMovementPos),s.row+1);i.moveToLogical(n)})}}class ot extends x{name="MoveCaretToStart";description="Move the caret to the start of the line.";keybinding={key:m.HOME,ctrl:!1,alt:!1};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{i.vertMovementPos=0,i.moveToLogical(new M(0,i.getLogical().row))})}}class lt extends x{name="MoveCaretToEnd";description="Move the caret to the end of the line.";keybinding={key:m.END,ctrl:!1,alt:!1};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{let s=e.getOpenedDocument().getLineLength(i.getLogical().row);i.vertMovementPos=s,i.moveToLogical(new M(s,i.getLogical().row))})}}class at extends x{name="CtrlMoveCaretLeft";description="Move the caret to the beginning of the previous word.";keybinding={key:m.ARROW_LEFT,ctrl:!0,alt:!1};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{const s=B.getOffsetToPreviousWord(i.editor.getOpenedDocument(),i.getOffset(),B.DELIMITER);i.shift(s)})}}class ht extends x{name="CtrlMoveCaretRight";description="Move the caret to the beginning of the next word.";keybinding={key:m.ARROW_RIGHT,ctrl:!0,alt:!1};run(e,t){e.view.resetBlink(),e.caretModel.forEachCaret(i=>{const s=B.getOffsetToNextWord(i.editor.getOpenedDocument(),i.getOffset(),B.DELIMITER);i.shift(s)})}}class ct extends x{name="TabAction";description="Insert a tab character at the caret position.";keybinding={key:m.TAB,ctrl:!1,alt:!1,shift:!1};run(e,t){t.preventDefault(),e.caretModel.forEachCaret(i=>{e.insertText(i.getOffset(),"    "),e.caretModel.shift(4)}),e.view.resetBlink()}}class ut extends x{name="SelectAll";description="Select all text in the editor.";keybinding={key:m.A,ctrl:!0,alt:!1,shift:!1};run(e,t){e.getCaretModel().removeAll(),e.getCaretModel().getPrimary().getSelectionModel().select(0,e.getOpenedDocument().getTotalDocumentLength()),e.view.resetBlink()}}class re extends x{static DELIMITER=/[\s.,;:!?(){}[\]<>]/;name="SelectDoubleClick";description="Select word under the caret.";keybinding={key:m.LeftDoubleClick,shift:!1};run(e){const t=e.getPrimaryCaret(),i=e.getOpenedDocument().getWordAt(t.getOffset(),re.DELIMITER);t.selectionModel.select(i.begin,i.end),e.view.resetBlink()}}class dt{editor;actions=[];constructor(e){this.editor=e,this.addAction(new it),this.addAction(new st),this.addAction(new rt),this.addAction(new nt),this.addAction(new ot),this.addAction(new lt),this.addAction(new at),this.addAction(new ht),this.addAction(new Je),this.addAction(new ct),this.addAction(new et),this.addAction(new tt),this.addAction(new ut),this.addAction(new re)}addAction(e){this.actions.push(e),e.keybinding&&this.editor.eventsManager.addKeybindingListener(e.keybinding,e.run)}}class pt{id;isRendered=!1;isShown=!1;owner;element;constructor(e){this.owner=e,this.id=O.registerPopup(e,this)}onDestroy(e){}isInBound(e,t){if(!this.isShown||!this.element)return!1;let i=this.owner?.getRenderedView();return d.isInBound(this.element,e,t)||i&&i.isInBound(e,t)}close(){this.isShown=!1,this.element.style.display="none"}show(){this.isShown=!0,this.element.style.display="flex"}}class gt extends pt{name="message-box";msg;constructor(e,t){super(e),this.msg=t}render(e){this.element=document.createElement("div"),this.element.className="editor-popup popup-message-box md";let t=this.msg.toHTML();for(let i of t)this.element.appendChild(i);return this.isRendered=!0,this.element}}class ft{}class mt{parts;constructor(e){this.parts=e}toHTML(){return this.parts.map(e=>e.render())}}class wt extends ft{text;effects;constructor(e,t){super(),this.text=e,this.effects=t}render(){let e=document.createElement("span");return e.innerText=this.text,this.effects.apply(e),e}}class L{static HEADER_LEVEL_TO_ELEMENT=["h1","h2","h3","h4","h5","h6"];isBold;isItalic;isUnderline;isStrikethrough;myHeaderLevel;constructor(e){this.isBold=e.bold??!1,this.isItalic=e.italic??!1,this.isUnderline=e.underline??!1,this.isStrikethrough=e.strikethrough??!1,this.myHeaderLevel=e.headerLevel??3}static none(){return new L({})}static bold(){return new L({bold:!0})}static italic(){return new L({italic:!0})}static underline(){return new L({underline:!0})}static strikethrough(){return new L({strikethrough:!0})}static h1(){return new L({headerLevel:1})}static h2(){return new L({headerLevel:2})}static h3(){return new L({headerLevel:3})}static h4(){return new L({headerLevel:4})}static h5(){return new L({headerLevel:5})}static h6(){return new L({headerLevel:6})}bold(){return this.isBold=!0,this}italic(){return this.isItalic=!0,this}underline(){return this.isUnderline=!0,this}strikethrough(){return this.isStrikethrough=!0,this}headerLevel(e){return this.myHeaderLevel=e,this}h1(){return this.myHeaderLevel=1,this}h2(){return this.myHeaderLevel=2,this}h3(){return this.myHeaderLevel=3,this}h4(){return this.myHeaderLevel=4,this}h5(){return this.myHeaderLevel=5,this}h6(){return this.myHeaderLevel=6,this}apply(e){this.isBold&&(e.style.fontWeight="bold"),this.isItalic&&(e.style.fontStyle="italic"),this.isUnderline&&(e.style.textDecoration="underline"),this.isStrikethrough&&(e.style.textDecoration="line-through"),e.classList.add(L.HEADER_LEVEL_TO_ELEMENT[this.myHeaderLevel-1])}}class vt{static parse(e){return new mt([new wt(e,L.none())])}}class ne{id;className;content;range;view=void 0;constructor(){this.id=O.getComponentIDFor(this)}getRenderedView(){return this.view}onDestroy(e){this.view=void 0}onRender(e){this.view=e,this.onceRendered()}onceRendered(){}}class yt extends ne{name="inline-error";className="js-error-marker";content;msg;range;constructor(e,t,i,s){super(),this.range=e.cloneNotTracked(),this.className+=" "+t,this.content=i,this.msg=s;let n=e.end-e.begin-this.content.length;n>0&&(this.content+=" ".repeat(n))}onceRendered(){this.view.addEventListener("mouseover",e=>{setTimeout(()=>{this.view?.isInBound(e.x,e.y,2)},800)})}createPopup(){return new gt(this,vt.parse(this.msg))}}class P{weight;left;right;value;constructor(e=null,t=null,i=null){this.value=e,this.left=t,this.right=i,e!==null?this.weight=e.length:t?this.weight=t.getTotalWeight():this.weight=0}isLeaf(){return this.left===null&&this.right===null}getTotalWeight(){return this.isLeaf()?this.value?this.value.length:0:(this.left?this.left.getTotalWeight():0)+(this.right?this.right.getTotalWeight():0)}}class F{root;constructor(e=""){this.root=new P(e)}concat(e){this.root=new P(null,this.root,e.root),this.root.weight=this.root.left.getTotalWeight()}index(e){return this._index(this.root,e)}toString(){return this._toString(this.root)}split(e){const[t,i]=this._split(this.root,e),s=new F;s.root=t;const n=new F;return n.root=i,[s,n]}insert(e,t){const[i,s]=this.split(e),n=new F(t);i.concat(n),i.concat(s),this.root=i.root}delete(e,t){const[i,s]=this.split(e),[n,l]=s.split(t);return i.concat(l),this.root=i.root,n.toString()}length(){return this.root.getTotalWeight()}substring(e,t){if(t===void 0&&(t=this.length()),e<0||t>this.length()||e>t)throw new Error("Invalid range for substring");return this._toString(this.root).substring(e,t)}getTextInRange(e){return this.substring(e.begin,e.end)}_index(e,t){if(e.isLeaf()){if(!e.value||t>=e.value.length)throw new Error("Index out of bounds");return e.value[t]}return t<e.weight?this._index(e.left,t):this._index(e.right,t-e.weight)}_toString(e){return e.isLeaf()?e.value??"":this._toString(e.left)+this._toString(e.right)}_split(e,t){if(e.isLeaf()){const i=e.value.substring(0,t),s=e.value.substring(t);return[new P(i),new P(s)]}if(t<e.weight){const[i,s]=this._split(e.left,t),n=new P(null,s,e.right);return[i,n]}else{const[i,s]=this._split(e.right,t-e.weight),n=new P(null,e.left,i);return n.weight=e.left.getTotalWeight(),[n,s]}}}class de{constructor(e,t,i,s){this.document=e,this.lineno=t,this.lineStart=i,this.lineEnd=s}getStart(){return this.lineStart}getEnd(){return this.lineEnd}getAssociatedRange(){return new h(this.lineStart,this.lineEnd)}getLineLength(){return this.lineEnd-this.lineStart}getLineNumber(){return this.lineno}getText(){return this.document.getTextBetween(this.lineStart,this.lineEnd)}charAt(e){return this.document.getTextBetween(this.lineStart+e,this.lineStart+e+1)}}class Et{scoping;code;parser;constructor(e,t){this.scoping=e.createScopeManager(),this.code=e.parse(this.scoping.toplevel(),t),this.parser=e}patch(e,t){e.children!==void 0&&(e.children=t)}getContainingNodeAt(e){return this.scoping.getContainingNodeAt(e)||this.code}getScopingModel(){return this.scoping}}class Lt{constructor(e,t){this.editor=e,this.file=t,this.language=t.type,this.data=new F(t.getContentAsString()),this.parseLines(),this.editor.addVisualEventListener(new class extends j{onAttached(i,s){i.getOpenedDocument().loadSRTree(i)}})}language;data;srTree;lines;lineBreaks=[];getTextContent(){return this.data.toString()}getCharAt(e){return this.data.index(e)}getTextBetween(e,t){return this.data.substring(e,t)}getWordAt(e,t){let i=this.getLineAt(e),s=i.getStart();e-=s;function n(u){return t.lastIndex=0,t.test(u)}let l=-1;for(let u=e;u>=0;u--)if(n(i.charAt(u))){l=u;break}let c=-1;for(let u=e;u<i.getLineLength();u++)if(n(i.charAt(u))){c=u;break}return l=l===-1?0:l+1,c===-1&&(c=i.getLineLength()),new h(l+s,c+s)}getTotalDocumentLength(){return this.data.length()}getLine(e){return this.lines[e]}getLineAt(e){for(let t=0;t<this.lineBreaks.length;t++)if(this.lineBreaks[t]>e)return this.lines[t-1];return this.lines[this.lines.length-1]}getLineBetween(e,t){return this.lines.slice(e,t)}getLineLength(e){return this.lines[e].getLineLength()}getMaxLengthLine(){return Math.max(...this.lines.map(e=>e.getLineLength()))}getLineCount(){return this.lines.length}getLanguage(){return this.language}getSrTree(){return this.srTree}insertText(e,t){this.data.insert(e,t),this.recomputeLines(e,t,!1),R.getInstance().updateRanges(e,t.length)}deleteAt(e,t){let i=this.data.delete(e,t);return this.recomputeLines(e,i,!0),R.getInstance().updateRanges(e,-t),i}getAssociatedContext(e){let t=this.srTree.scoping.toplevel();return{begin:t.range.begin,end:t.range.end,text:this.data.getTextInRange(t.range),scope:t,containingNode:this.srTree.getContainingNodeAt(e)}}loadSRTree(e){this.srTree=new Et(e.getParserForFileType(this.language),e.getLexerForFileType(this.language).asTokenStream(this.getTextContent()))}parseLines(){this.lines=[],this.lineBreaks=[0];let e=this.getTextContent();for(let t=0;t<e.length;t++)e[t]===`
`&&this.lineBreaks.push(t+1);for(let t=0;t<this.lineBreaks.length;t++){let i=this.lineBreaks[t],s=t+1<this.lineBreaks.length?this.lineBreaks[t+1]-1:this.getTotalDocumentLength();this.lines.push(new de(this,t,i,s))}}recomputeLines(e,t,i=!1){let s=this.getLineAt(e).getLineNumber()+1;s>this.getLineCount()&&(s=this.lineBreaks.length);let n=0;for(const l of t.matchAll(/\n/g))if(i)this.lines.splice(this.lineBreaks.indexOf(e+l.index+1),1),this.lineBreaks.splice(this.lineBreaks.indexOf(e+l.index+1),1);else{let c=e+l.index+1;this.lineBreaks.splice(s+n,0,c),n++}for(let l=s+n;l<this.lineBreaks.length;l++)this.lineBreaks[l]+=i?-t.length:t.length;this.lines=this.lines.slice(0,s-1);for(let l=s-1;l<this.lineBreaks.length;l++){let c=this.lineBreaks[l],u=l+1<this.lineBreaks.length?this.lineBreaks[l+1]-1:this.getTotalDocumentLength();this.lines.push(new de(this,l,c,u))}}}class xt{name;id;line;element;constructor(e){this.id=O.getComponentIDFor(this),this.line=e}onDestroy(e){}render(){return this.element||(this.element=document.createElement("span"),this.element.className="gutter-line-number",this.element.textContent=(this.line+1).toString()),this.element}getWidth(e){return this.element.getBoundingClientRect().width}}class kt{constructor(e,t){this.editor=e,this.elements=t,this.stylesheet=X.createStyleProxy(t)}stylesheet;addEventListener(e,t){return this.elements.forEach(i=>i.addEventListener(e,t,!0))}isInBound(e,t,i=5){return this.elements.some(s=>d.isInBound(s,e,t,i))}getCombinedChildren(){return this.elements.map(e=>e.children).reduce((e,t)=>{let i=Array.from(e);return i.push(...Array.from(t)),i},[])}getClassName(){let e=new Set(this.elements.map(t=>t.className.trim()).filter(t=>t.length>0).flatMap(t=>t.split(" ")));return Array.from(e).join(" ")}getClientHeight(){return this.elements[0].clientHeight}getClientWidth(){return this.elements.map(e=>e.clientWidth).reduce((e,t)=>e+t,0)}getClientTop(){return this.elements[0].clientTop}getClientLeft(){return this.elements[0].clientLeft}getInnerHTML(){return this.elements.map(e=>e.innerHTML).join("")}getTextContent(){return this.elements.map(e=>e.textContent).join("")}getCommonTagName(){return this.elements[0].tagName}getPreviousElementSibling(){return this.elements[0].previousElementSibling}getNextElementSibling(){return this.elements[this.elements.length-1].nextElementSibling}getParentElement(){return this.elements[0].parentElement}getCommonStylesheet(){return this.stylesheet}getAssociatedElements(){return this.elements}getEditor(){return this.editor}addClass(e){this.elements.forEach(t=>t.classList.add(e))}removeClass(e){this.elements.forEach(t=>t.classList.remove(e))}}class X{static createCommonStylesheet(e){let t=new Map;if(e.length===0)return t;const i=e[0].style;for(let s=0;s<i.length;s++){const n=i.item(s);if(n){const l=i.getPropertyValue(n);let c=!0;for(let u=1;u<e.length;u++)if(e[u].style.getPropertyValue(n)!==l){c=!1;break}c&&t.set(n,l)}}return t}static createStyleProxy(e){const t=X.createCommonStylesheet(e);return new Proxy({setProperty(i,s,n){t.set(i,s);for(const l of e)l.style.setProperty(i,s??"",n)},getPropertyValue(i){if(t.has(i))return t.get(i)??"";for(const s of e){const n=s.style.getPropertyValue(i);if(n)return n}return""}},{get(i,s,n){return typeof s=="string"?i.getPropertyValue(s):Reflect.get(i,s,n)},set(i,s,n,l){return typeof s=="string"?(i.setProperty(s,n),!0):Reflect.set(i,s,n,l)}})}static createView(e,t){if(t[0].tagName==="SPAN")return new kt(e,t);throw new Error("Unsupported element type: "+t[0].tagName)}}class St{manager;constructor(e){this.manager=e}render(e){return this.renderComponents(this.manager.getComponentsForRange(e),e.begin)}renderGutterComponents(e){return this.manager.getAssociatedGutterComponents(e).map(i=>i.render())}renderLine(e){let t=this.manager.getDocument();return e>=t.getLineCount()?{gutter:[],content:[],line:e}:{content:this.render(t.getLine(e).getAssociatedRange()),gutter:this.renderGutterComponents(e),line:e}}renderNLines(e,t){let i=[];for(let s=0;s<t;s++)i.push(this.renderLine(e+s));return i}renderComponents(e,t=0){if(e??=this.manager.getAllComponents(),!e.length)return[];let i=e.flatMap(c=>[{pos:c.range.begin,type:"start",component:c,spans:[]},{pos:c.range.end,type:"end",component:c}]);i.sort((c,u)=>c.pos-u.pos||(c.type==="end"?1:-1));const s=[];let n=[],l=t;for(const c of i){const u=c.pos;if(u>l)if(n.length===0){const g=document.createElement("span");g.textContent=" ".repeat(u-l),s.push(g)}else{const g=n.map(z=>z.component.className).join(" ").trim(),w=n[0].component,k=Math.max(l,w.range.begin),Ce=Math.min(u,w.range.end),be=w.content.slice(k-w.range.begin,Ce-w.range.begin),D=document.createElement("span");D.className=g,D.textContent=be,s.push(D),n.forEach(z=>z.spans?.push(D))}if(c.type==="start")n.push(c);else{const g=n.findIndex(k=>k.component===c.component),w=n[g];w.component.onRender(X.createView(this.manager.editor,w.spans)),g!==-1&&n.splice(g,1)}l=u}return s}}class Ct{editor;document;renderer;components=[];gutterComponents=[];constructor(e){this.editor=e,this.document=e.getOpenedDocument(),this.renderer=new St(this)}getComponentsRanges(){return this.components.map(e=>e.range)}getAllComponents(){return this.components}getComponentsForRange(e){return this.components.filter(t=>e.contains(t.range))}getAssociatedGutterComponents(e){return[new xt(e)].concat(this.gutterComponents.filter(t=>t.line===e))}add(e){this.components.push(e)}addError(e){this.components.push(e)}addGutterComponent(e){this.gutterComponents.push(e)}setRange(e,t){this.clearRange(e);for(const i of t)this.add(i)}clearRange(e){let t=[],i=[];for(let s of this.components)s.range.overlaps(e)?s.onDestroy(this.editor):t.push(s);for(let s of this.gutterComponents){let n=this.editor.offsetToLogical(e.begin),l=this.editor.offsetToLogical(e.end);s.line>=n.row&&s.line<=l.row?s.onDestroy(this.editor):i.push(s)}this.components=t,this.gutterComponents=i}getDocument(){return this.document}getRenderer(){return this.renderer}}class xe{__brand="point";x;y;constructor(e,t){this.x=e,this.y=t}}class bt{constructor(e){this.view=e,this.editor=e.editor}editor;offsetToLogical(e){const i=this.editor.getOpenedDocument().getLineAt(e);return new M(e-i.getStart(),i.getLineNumber())}offsetToVisual(e){return this.logicalToVisual(this.offsetToLogical(e))}offsetToXY(e){return this.logicalToXY(this.offsetToLogical(e))}logicalToOffset(e){return this.editor.getOpenedDocument().getLine(e.row).getStart()+e.col}logicalToVisual(e){return new ee(e.col,e.row)}logicalToXY(e){return this.visualToXY(this.logicalToVisual(e))}visualToOffset(e){return this.logicalToOffset(this.visualToLogical(e))}visualToLogical(e){return new M(e.col,e.row)}visualToXY(e){const t=this.view.getCharSize(),i=this.view.getLineHeight(),s=this.view.scroll.scrollYOffset===0?this.view.scroll.scrollYLines:this.view.scroll.scrollYLines-1,n=(e.col-this.view.scroll.scrollXChars)*t-this.view.scroll.scrollXOffset,l=(e.row-s)*i-this.view.scroll.scrollYOffset;return new xe(n,l)}xyToNearestVisual(e){const t=this.view.getCharSize(),i=this.view.getLineHeight(),s=this.view.scroll.scrollXOffset===0?this.view.scroll.scrollXChars:this.view.scroll.scrollXChars-1,n=this.view.scroll.scrollYOffset===0?this.view.scroll.scrollYLines:this.view.scroll.scrollYLines-1,l=Math.round((e.x+this.view.scroll.scrollXOffset)/t)+s,c=Math.floor((e.y+this.view.scroll.scrollYOffset)/i)+n;return new ee(l,c)}xyToLogical(e){return this.visualToLogical(this.xyToNearestVisual(e))}}class oe extends j{static ID=0;id;properties;file;project;view;root;document;componentManager;coordinateMapper;caretModel;eventsManager;actions;plugins;perfCheckRunning=!1;defaultLexer=new Ze;defaultHighlighter;renderingProcess;constructor(e,t){super(),this.id=oe.ID++,this.properties=t||{},this.file=this.properties.file||new Xe("temp","","js"),e&&e.addFile(this.file),this.project=e||Ue.singleFileProject(this.file),this.eventsManager=new Fe,this.eventsManager.addVisualEventListener(this),this.document=new Lt(this,this.file),this.componentManager=new Ct(this),this.view=new Ye(this),this.coordinateMapper=new bt(this.view),this.caretModel=new $e(this),this.actions=new dt(this),this.plugins=new ze(this),this.renderingProcess=setInterval(()=>{y.with(this,()=>{this.view.render()})},20)}get lang(){return this.document.getLanguage()}attach(e){y.with(this,()=>{this.root=d.createElement("div.editor",e),this.view.onAttached(this,this.root),this.fire("onAttached",this.root)})}fire(e,...t){y.with(this,()=>this.eventsManager.fire(e,this,...t))}fireLangEvent(e,...t){this.eventsManager.fireLangEvent(this.lang,e,this,...t)}fireKeybinding(e){y.with(this,()=>this.eventsManager.fireKeybinding(e,this))}fireMouseKeybinding(e){y.with(this,()=>this.eventsManager.fireMouseKeybinding(e,this))}registerPlugin(e){y.with(this,()=>{this.plugins.register(e)})}addVisualEventListener(e){this.eventsManager.addVisualEventListener(e)}addEditorEventListener(e){this.eventsManager.addEditorEventListener(e)}addLangEventListener(e,t){this.eventsManager.addLangEventListener(e,t)}removeVisualEventListener(e){this.eventsManager.removeVisualEventListener(e)}registerKeybinding(e,t){this.eventsManager.addKeybindingListener(e,t)}registerComponentKeybind(e,t,i){this.eventsManager.addConditionalEventListener(t,i,(s,n)=>e.getRenderedView()?.isInBound(n.clientX,n.clientY))}getOpenedDocument(){return this.document}getComponentManager(){return this.componentManager}getCaretModel(){return this.caretModel}getPrimaryCaret(){return this.caretModel.getPrimary()}getLexerForFileType(e){return this.plugins.getLexerForFileType(e)||this.defaultLexer}getHighlighterForFileType(e){return this.plugins.getHighlighterForFileType(e)||this.defaultHighlighter}getParserForFileType(e){return this.plugins.getParserForFileType(e)}getCurrentLexer(){return this.getLexerForFileType(this.document.getLanguage())}getCurrentHighlighter(){return this.getHighlighterForFileType(this.document.getLanguage())}getCurrentParser(){return this.getParserForFileType(this.document.getLanguage())}parse(e,t){return this.getCurrentParser().parse(e,t)}offsetToLogical(e){return e<0?e=0:e>this.document.getTotalDocumentLength()&&(e=this.document.getTotalDocumentLength()-1),this.coordinateMapper.offsetToLogical(e)}offsetToVisual(e){return this.coordinateMapper.offsetToVisual(e)}logicalToOffset(e){return this.coordinateMapper.logicalToOffset(e)}logicalToVisual(e){return this.coordinateMapper.logicalToVisual(e)}visualToOffset(e){return this.coordinateMapper.visualToOffset(e)}visualToLogical(e){return this.coordinateMapper.visualToLogical(e)}logicalToXY(e){return this.coordinateMapper.logicalToXY(e)}visualToXY(e){return this.coordinateMapper.visualToXY(e)}xyToNearestVisual(e,t){return this.coordinateMapper.xyToNearestVisual(new xe(e,t))}getFullRange(){return h.tracked(0,this.document.getTotalDocumentLength())}isValidOffset(e){return e>=0&&e<=this.document.getTotalDocumentLength()}moveCursorToMouseEvent(e){let[t,i]=this.view.getRelativePos(e),s=this.xyToNearestVisual(t,i);s.row<0?s.row=0:s.row>=this.document.getLineCount()&&(s.row=this.document.getLineCount()-1),s.col=Math.max(0,Math.min(s.col,this.document.getLineLength(s.row)));let n=this.visualToLogical(s);this.getPrimaryCaret().moveToLogical(n),this.view.resetBlink()}type(e){y.with(this,()=>{this.caretModel.forEachCaret(t=>{t.getSelectionModel().isSelectionActive&&this.deleteSelection(t),this.insertText(t.getOffset(),e),t.shift(),this.view.resetBlink()})})}insertText(e,t){this.document.insertText(e,t);let i=this.getCurrentLexer(),s=this.getCurrentHighlighter(),n=this.document.getAssociatedContext(e);n.scope.clear();let l=i.asTokenStream(n.text),c=this.parse(n.scope,l.clone()).children;this.document.getSrTree().patch(n.containingNode,c);let u=s.highlight(l);this.componentManager.setRange(n.scope.range,u),this.fireLangEvent("onSrLoaded",n,c,l),this.view.triggerRepaint()}deleteAt(e,t=1){if(e<0||e>=this.document.getTotalDocumentLength())return;this.document.deleteAt(e,t);let i=this.getCurrentLexer(),s=this.getCurrentHighlighter(),n=this.document.getAssociatedContext(e);n.scope.clear();let l=i.asTokenStream(n.text),c=this.parse(n.scope,l.clone()).children;this.document.getSrTree().patch(n.containingNode,c),this.componentManager.setRange(n.scope.range,s.highlight(l.clone())),this.fireLangEvent("onSrLoaded",n,c,l),this.view.triggerRepaint()}deleteSelection(e){let t=e.getSelectionModel();if(!t.isSelectionActive)return;let i=t.getStart();this.deleteAt(this.logicalToOffset(i),t.getSelectionLength()),e.moveToLogical(i)}getLineCount(){return this.document.getLineCount()}addErrorAt(e,t,i,s){this.componentManager.addError(new yt(e,t,i,s))}openPopup(e,t,i){i.isRendered||this.view.addPopup(i),i.isShown||this.view.showPopup(i,e,t)}onKeyUp(e,t){E.getInstance().set(t)}onKeyDown(e,t){if(t.key===m.ENTER)return E.getInstance().clear(),this.type(`
`);E.getInstance().set(t),this.fireKeybinding(t)}onMouseDown(e,t){E.getInstance().set(t),this.caretModel.removeAll(),this.moveCursorToMouseEvent(t),this.fireMouseKeybinding(t)}onMouseUp(e,t){E.getInstance().set(t),E.getInstance().setIsDragging(!1),E.getInstance().isMouseDown=!1}onMouseMove(e,t){E.isMouseDown&&(E.getInstance().setIsDragging(!0),this.moveCursorToMouseEvent(t))}onInput(e,t){E.getInstance().clear(),t.data&&this.type(t.data)}perfCheckBegin(){let e=performance.now();this.perfCheckRunning=!0;let t=()=>this.perfCheckRunning;requestAnimationFrame(function i(s){let l=1e3/(s-e);console.log(`FPS: ${l.toFixed(2)}`),e=s,t()&&requestAnimationFrame(i)})}perfCheckEnd(){this.perfCheckRunning=!1}pauseRender(){clearInterval(this.renderingProcess)}resumeRender(){this.renderingProcess=setInterval(()=>{y.with(this,()=>{this.view.render()})},20)}}var o=(r=>(r.Keyword="Keyword",r.Identifier="Identifier",r.Number="Number",r.String="String",r.Punctuation="Punctuation",r.LPAREN="LeftParen",r.RPAREN="RightParen",r.LBRACE="LeftBrace",r.RBrace="RightBrace",r.LBRACKET="LeftBracket",r.RBRACKET="RightBracket",r.Operator="Operator",r.UnOperator="UnOperator",r.IncrDecrOp="IncrDecrOp",r.Equals="Equals",r.EqualOp="EqualOp",r.CompareOp="CompareOp",r.Arrow="Arrow",r.EOL="EOL",r.EOF="EOF",r.SyntaxError="SyntaxError",r))(o||{});class q{static KEYWORDS=["var","let","const","if","else","switch","case","default","for","while","do","break","continue","return","try","catch","finally","throw","function","class","extends","super","this","new","await","async","yield","yield*","in","instanceof","delete","typeof","void","debugger","import","export","abstract","arguments","boolean","byte","char","double","enum","final","float","goto","implements","int","interface","long","native","package","private","protected","public","short","static","synchronized","throws","transient","volatile"];asTokenStream(e){return new Y(this,e)}tokenize(e){if(e.followupError)return e.clearError();for(;;){if(e.isEmpty())return new p("EOF","",h.tracked(e.index,e.index+1));let t=e.consume();if(t===`
`)return new p("EOL",`
`,h.around(e.index-1),!0);if(t!==" ")if(t>="0"&&t<="9"){let i=t;for(;!e.isEmpty()&&e.seek()>="0"&&e.seek()<="9";)i+=e.consume();return new p("Number",i,h.tracked(e.index-i.length,e.index))}else if(this.isAlphanumeric(t)){let i=t;for(;!e.isEmpty()&&(this.isAlphanumeric(e.seek())||e.seek()>="0"&&e.seek()<="9");)i+=e.consume();return q.KEYWORDS.includes(i)?new p("Keyword",i,h.tracked(e.index-i.length,e.index)):new p("Identifier",i,h.tracked(e.index-i.length,e.index))}else{if(t==="(")return new p("LeftParen","(",h.around(e.index-1));if(t===")")return new p("RightParen",")",h.around(e.index-1));if(t==="{")return new p("LeftBrace","{",h.around(e.index-1));if(t==="}")return new p("RightBrace","}",h.around(e.index-1));if(t==="[")return new p("LeftBracket","[",h.around(e.index-1));if(t==="]")return new p("RightBracket","]",h.around(e.index-1));if(t===".")return e.seek()==="."&&e.seekNext()==="."?(e.consume(),e.consume(),new p("Punctuation","...",h.tracked(e.index-3,e.index))):new p("Punctuation",".",h.around(e.index-1));if(t===","||t===";"||t===":")return new p("Punctuation",t,h.around(e.index-1));if(t==="=")return e.seek()==="="?(e.consume(),e.seek()==="="?(e.consume(),new p("CompareOp","===",h.tracked(e.index-3,e.index))):new p("CompareOp","==",h.tracked(e.index-2,e.index))):e.seek()===">"?(e.consume(),new p("Arrow","=>",h.tracked(e.index-2,e.index))):new p("Equals","=",h.around(e.index-1));if(t=="+"||t==="-"||t==="*"||t==="/")return e.seek()==="="?(e.consume(),new p("EqualOp",t+"=",h.tracked(e.index-2,e.index))):t===e.seek()?(e.consume(),t==="+"||t==="-"?new p("IncrDecrOp",t+t,h.tracked(e.index-2,e.index)):new p("Operator",t+t,h.around(e.index-2))):new p("Operator",t,h.around(e.index-1));if(t===">"||t==="<")return e.seek()==="="?(e.consume(),new p("CompareOp",t+"=",h.tracked(e.index-2,e.index))):e.seek()===t?(e.consume(),t===">"&&e.seek()===">"?(e.consume(),new p("Operator",">>>",h.tracked(e.index-3,e.index))):new p("Operator",t+t,h.tracked(e.index-2,e.index))):new p("CompareOp",t,h.around(e.index-1));if(t==="|"||t==="&"||t==="?"||t==="^")return e.seek()==="="?new p("EqualOp",t+"=",h.around(e.index-2)):e.seek()===t&&t!=="^"?(e.consume(),new p("Operator",t+t,h.tracked(e.index-2,e.index))):t!=="?"?new p("Operator",t,h.around(e.index-1)):new p("Punctuation","?",h.around(e.index-1));if(t==="!"||t==="~")return new p("UnOperator",t,h.around(e.index-1));if(t==="'"||t==='"'){let i=t;for(;!e.isEmpty()&&e.seek()!==t&&e.seek()!==`
`;)i+=e.consume();return e.seek()===t?(i+=e.consume(),new p("String",i,h.tracked(e.index-i.length,e.index))):(e.followupError=new I("SyntaxError",i[i.length-1],"Unterminated string literal",h.around(e.index-1)),new p("String",i,h.tracked(e.index-i.length,e.index)))}else return new I("SyntaxError",t,"Unexpected char: "+t,h.around(e.index-1))}}}isAlphanumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_"||e==="$"}}class Tt{*highlight(e){for(;!e.isEmpty();){const t=e.consume();if(t){const i=this._impl[`visit${t.type}`];let s=i(t);s&&(yield s)}}}}class f extends ne{name="highlighted-token";range;element=null;className;content;constructor(e,t){super(),this.content=e.value,this.range=e.range.cloneNotTracked(),this.className="editor-ht "+t}}class Rt extends Tt{_impl=this;visitEqualOp(e){return new f(e,"js-operator")}visitCompareOp(e){return new f(e,"js-operator")}visitArrow(e){return new f(e,"js-operator")}visitUnOperator(e){return new f(e,"js-operator")}visitIncrDecrOp=e=>new f(e,"js-operator");visitString(e){return new f(e,"js-string")}visitIdentifier(e){return new f(e,"js-identifier")}visitNumber(e){return new f(e,"js-number")}visitPunctuation(e){return new f(e,"js-default")}visitLeftParen(e){return new f(e,"js-left-paren js-default")}visitRightParen(e){return new f(e,"js-right-paren js-default")}visitLeftBrace(e){return new f(e,"js-left-brace js-default")}visitRightBrace(e){return new f(e,"js-right-brace js-default")}visitLeftBracket(e){return new f(e,"js-left-bracket js-default")}visitRightBracket(e){return new f(e,"js-right-bracket js-default")}visitOperator(e){return new f(e,"js-operator")}visitEquals(e){return new f(e,"js-operator")}visitEOL(e){return null}visitEOF(e){return null}visitSyntaxError(e){return new f(e,"js-syntax-error")}visitKeyword(e){return new f(e,"js-keyword")}}class ke{static indent(e,t=4){const i=" ".repeat(t);return e.split(`
`).map(s=>i+s).join(`
`)}}class a{static tokenToHumanReadableString(e){return e?e.isError?`#${e.type}<${e.msg}>`:e.value:"#undef"}static toHumanReadableString(e){return e?e.toHumanReadableString():"#undef"}static isValidToken(e){return!!e&&!e.isError&&!e.isSpecial}}class V{static precedenceMap={"**":15,"*":14,"/":14,"+":13,"-":13,"<<":12,">>":12,">>>":12};static isRightAssociative(e){return e==="**"}static getPrecedence(e){return V.precedenceMap[e]}}var b=(r=>(r.CodeBlock="CodeBlock",r.Stmt="Stmt",r.DeclStmt="DeclStmt",r.Body="Body",r.Parameters="Parameters",r.Param="Param",r.FuncDeclStmt="FuncDeclStmt",r.ReturnStmt="ReturnStmt",r.Expr="Expr",r.ExprGroup="ExprGroup",r.ExprCommaExpr="ExprCommaExpr",r.NumberLiteral="NumberLiteral",r.StringLiteral="StringLiteral",r.Args="Args",r.Identifier="Identifier",r.SpecialIdentifier="SpecialIdentifier",r.MemberAccess="MemberAccess",r.AssignExpr="AssignExpr",r.UnaryExpr="UnaryExpr",r.BinaryExpr="BinaryExpr",r.TernaryExpr="TernaryExpr",r.CallExpr="CallExpr",r.NewExpr="NewExpr",r.ArrayAccess="ArrayAccess",r.ArrayLiteral="ArrayLiteral",r.ObjectLiteral="ObjectLiteral",r.ObjectLiteralProperty="ObjectLiteralProperty",r.ObjectLiteralPropertyFunction="ObjectLiteralPropertyFunction",r.Lambda="Lambda",r))(b||{});class C{declares=[];range;language="js";parent=null;constructor(){for(let e of this.getAllNodeChildren())e.parent=this}getAllNodeChildren(){const e=[];for(let t in this)this[t]instanceof C&&e.push(this[t]);return e}getNodeContent(){const e=[];for(let t of this.declares){let i=this[t];(i instanceof p||i instanceof C)&&e.push(i)}return e}}class pe extends C{range;children;nodeType="CodeBlock";constructor(e){super(),this.children=e,this.range=h.of(e)}toHumanReadableString(){let e="";for(const t of this.children)e+=t.toHumanReadableString()+`
`;return`{
`+ke.indent(e.substring(0,e.length-1))+`
}`}isWellFormed(){return this.children.every(e=>e.isWellFormed())}getNodeContent(){return this.children}}class le extends C{range;nodeType="Stmt";constructor(e){super(),this.range=e}}class G extends le{declares=["kind","name","eq","decl"];kind;name;eq;decl;nodeType="DeclStmt";constructor(e,t,i,s){super(h.of(e,s||t)),this.kind=e,this.name=t,this.eq=i,this.decl=s}isWellFormed(){return this.kind&&this.name&&a.isValidToken(this.kind)&&a.isValidToken(this.name)&&(!this.eq||a.isValidToken(this.eq))&&(!this.decl||this.decl.isWellFormed())}toHumanReadableString(){let e=a.tokenToHumanReadableString(this.kind);return e+=" "+a.tokenToHumanReadableString(this.name)+" = ",e+=a.toHumanReadableString(this.decl),e+";"}}class $ extends le{declares=["keyword","expr"];keyword;expr;nodeType="ReturnStmt";constructor(e,t){super(h.of([e,t])),this.keyword=e,this.expr=t}isWellFormed(){return a.isValidToken(this.keyword)&&(!this.expr||this.expr.isWellFormed())}toHumanReadableString(){return"return "+a.toHumanReadableString(this.expr)+";"}}class K extends C{declares=["openBrace","body","closeBrace"];openBrace;body;closeBrace;nodeType="Body";constructor(e,t,i){super(),this.range=h.of([e,t,i]),this.openBrace=e,this.body=t,this.closeBrace=i}isWellFormed(){return(!this.openBrace||a.isValidToken(this.openBrace))&&this.body.isWellFormed()&&(!this.closeBrace||a.isValidToken(this.closeBrace))}toHumanReadableString(){return a.toHumanReadableString(this.body)}}class N extends C{declares=[];params;commas=[];nodeType="Parameters";constructor(e,t=[]){super(),this.range=h.of(e),this.params=e,this.commas=t}toHumanReadableString(){return this.params.map(e=>a.toHumanReadableString(e)).join(", ")}isWellFormed(){return this.params.every(e=>e.isWellFormed())}getNodeContent(){let e=[];for(let t=0;t<this.params.length;t++)e.push(this.params[t]),t<this.commas.length&&e.push(this.commas[t]);return e}}class S extends C{declares=["restToken","name","eqSign","defaultValue"];restToken;name;eqSign;defaultValue;nodeType="Param";constructor(e,t,i,s){super(),this.name=e,this.restToken=t,this.eqSign=i,this.defaultValue=s,this.range=s?h.of(t||e,s):h.of(t||e,i||e)}isWellFormed(){return a.isValidToken(this.name)&&(!this.restToken||a.isValidToken(this.restToken))&&(!this.eqSign||a.isValidToken(this.eqSign))&&(!this.defaultValue||this.defaultValue.isWellFormed())}toHumanReadableString(){let e=this.restToken?"...":"";return e+=a.tokenToHumanReadableString(this.name),this.eqSign&&(e+="=",e+=a.toHumanReadableString(this.defaultValue)),e}}class W extends le{declares=["keyword","name","openParen","params","closeParen","body"];keyword;name;openParen;params;closeParen;body;nodeType="FuncDeclStmt";constructor(e,t,i,s,n,l){super(h.of([e,t,i,s,n,l])),this.keyword=e,this.name=t,this.openParen=i,this.params=s,this.closeParen=n,this.body=l}isWellFormed(){return a.isValidToken(this.keyword)&&(!this.name||a.isValidToken(this.name))&&a.isValidToken(this.openParen)&&a.isValidToken(this.closeParen)&&this.params.isWellFormed()&&this.body.isWellFormed()}toHumanReadableString(){let e=a.tokenToHumanReadableString(this.keyword);return this.name&&(e+=" "+a.tokenToHumanReadableString(this.name)),e+="("+a.toHumanReadableString(this.params)+")",e+" "+a.toHumanReadableString(this.body)}}class v extends C{declares=["error"];error;nodeType="Expr";constructor(e=null){super(),this.error=e,e&&(this.range=h.of(e))}toHumanReadableString(){return a.tokenToHumanReadableString(this.error)}isWellFormed(){return!this.error}}class At extends v{values;commas;nodeType="ExprCommaExpr";constructor(e,t){super(),this.values=e,this.commas=t,this.range=h.of(e)}toHumanReadableString(){return this.values.map(e=>a.toHumanReadableString(e)).join(", ")}isWellFormed(){return this.values.every(e=>e.isWellFormed())}getNodeContent(){let e=[];for(let t=0;t<this.values.length;t++)e.push(this.values[t]),t<this.commas.length&&e.push(this.commas[t]);return e}}class Mt extends v{declares=["value"];value;nodeType="NumberLiteral";constructor(e){super(),this.range=h.of(e),this.value=e}toHumanReadableString(){return a.tokenToHumanReadableString(this.value)}isWellFormed(){return a.isValidToken(this.value)}}class Pt extends v{declares=["value"];value;nodeType="StringLiteral";constructor(e){super(),this.range=h.of(e),this.value=e}toHumanReadableString(){return a.tokenToHumanReadableString(this.value)}isWellFormed(){return a.isValidToken(this.value)}}class ge extends v{openBracket;values;closeBracket;commas;nodeType="ArrayLiteral";constructor(e,t,i,s){super(),this.openBracket=e,this.values=t,this.closeBracket=i,this.commas=s,this.range=h.of([e,...t,i])}toHumanReadableString(){return"["+this.values.map(e=>a.toHumanReadableString(e)).join(", ")+"]"}isWellFormed(){return a.isValidToken(this.openBracket)&&this.values.every(e=>e.isWellFormed())&&a.isValidToken(this.closeBracket)}getNodeContent(){let e=[];e.push(this.openBracket);for(let t=0;t<this.values.length;t++)e.push(this.values[t]),t<this.commas.length&&e.push(this.commas[t]);return this.closeBracket&&e.push(this.closeBracket),e}}class H extends C{declares=["key","colon","value"];key;colon;value;nodeType="ObjectLiteralProperty";constructor(e,t,i){super(),this.key=e,this.colon=t,this.value=i,this.range=h.of([e,t,i])}isWellFormed(){return a.isValidToken(this.key)&&(!this.colon||a.isValidToken(this.colon))&&(!this.value||this.value.isWellFormed())}toHumanReadableString(){let e=this.key.value;return(this.colon&&!this.colon.isError||this.value)&&(e+=": "),this.value?e+=this.value.toHumanReadableString():e+="#undef",e}}class Bt extends H{declares=["func"];func;nodeType="ObjectLiteralPropertyFunction";constructor(e){super(e.name,null,e),this.func=e}isWellFormed(){return this.func.isWellFormed()}toHumanReadableString(){return a.toHumanReadableString(this.func)}}class fe extends v{openBrace;properties;closeBrace;commas;nodeType="ObjectLiteral";constructor(e,t,i,s){super(),this.openBrace=e,this.properties=t,this.closeBrace=i,this.commas=s,this.range=h.of([e,...t,i])}isWellFormed(){return a.isValidToken(this.openBrace)&&this.properties.every(e=>e.isWellFormed())&&(!this.closeBrace||a.isValidToken(this.closeBrace))}toHumanReadableString(){if(this.properties.length<=2&&!this.properties.some(e=>e.nodeType==="ObjectLiteralPropertyFunction"))return"{ "+this.properties.map(e=>e.toHumanReadableString()).join(", ")+" }";{let e=`{
`;for(const t of this.properties)e+=ke.indent(t.toHumanReadableString())+`,
`;return e+="}",e}}getNodeContent(){let e=[];e.push(this.openBrace);for(let t=0;t<this.properties.length;t++)e.push(this.properties[t]),t<this.commas.length&&e.push(this.commas[t]);return this.closeBrace&&e.push(this.closeBrace),e}}class te extends v{declares=["token"];token;nodeType="Identifier";constructor(e){super(),this.token=e,this.range=h.of(e)}isWellFormed(){return a.isValidToken(this.token)}toHumanReadableString(){return a.tokenToHumanReadableString(this.token)}}class Ot extends te{nodeType="SpecialIdentifier";constructor(e){super(e)}}class Ht extends v{declares=["base","dot","member"];base;dot;member;nodeType="MemberAccess";constructor(e,t,i){super(),this.base=e,this.dot=t,this.member=i,this.range=h.of(e,i)}isWellFormed(){return this.base.isWellFormed()&&a.isValidToken(this.dot)&&this.member.isWellFormed()}toHumanReadableString(){return a.toHumanReadableString(this.base)+"."+a.toHumanReadableString(this.member)}}class It extends v{declares=["left","operator","right"];left;operator;right;nodeType="AssignExpr";constructor(e,t,i){super(),this.left=e,this.operator=t,this.right=i,this.range=h.of(e,i||t)}isWellFormed(){return this.left.isWellFormed()&&a.isValidToken(this.operator)&&(!this.right||this.right.isWellFormed())}toHumanReadableString(){return"("+a.toHumanReadableString(this.left)+" = "+a.toHumanReadableString(this.right)+")"}}class Q extends v{declares=["operator","operand"];operator;operand;nodeType="UnaryExpr";constructor(e,t){super(),this.operator=e,this.operand=t,this.range=h.of(e,t)}isWellFormed(){return a.isValidToken(this.operator)&&this.operand.isWellFormed()}toHumanReadableString(){return"("+a.tokenToHumanReadableString(this.operator)+a.toHumanReadableString(this.operand)+")"}}class A extends v{declares=["left","operator","right"];left;operator;right;nodeType="BinaryExpr";constructor(e,t,i){super(),this.left=e,this.operator=t,this.right=i,this.range=h.of(e,i)}isWellFormed(){return this.left.isWellFormed()&&a.isValidToken(this.operator)&&this.right.isWellFormed()}toHumanReadableString(){return"("+a.toHumanReadableString(this.left)+" "+a.tokenToHumanReadableString(this.operator)+" "+a.toHumanReadableString(this.right)+")"}}class me extends v{declares=["condition","questionMark","trueExpr","colon","falseExpr"];condition;questionMark;trueExpr;colon;falseExpr;nodeType="TernaryExpr";constructor(e,t,i,s,n){super(),this.condition=e,this.questionMark=t,this.trueExpr=i,this.colon=s,this.falseExpr=n,this.range=h.of(e,n||s)}isWellFormed(){return this.condition.isWellFormed()&&a.isValidToken(this.questionMark)&&this.trueExpr.isWellFormed()&&a.isValidToken(this.colon)&&(!this.falseExpr||this.falseExpr.isWellFormed())}toHumanReadableString(){return a.toHumanReadableString(this.condition)+" ? ("+a.toHumanReadableString(this.trueExpr)+") : ("+a.toHumanReadableString(this.falseExpr)+")"}}class ie extends v{declares=["callee","openParen","args","closeParen"];callee;openParen;args;closeParen;nodeType="CallExpr";constructor(e,t,i,s){super(),this.callee=e,this.openParen=t,this.args=i,this.closeParen=s,this.range=h.of([e,t,i,s])}isWellFormed(){return this.callee.isWellFormed()&&a.isValidToken(this.openParen)&&a.isValidToken(this.closeParen)&&this.args.isWellFormed()}toHumanReadableString(){return a.toHumanReadableString(this.callee)+"("+a.toHumanReadableString(this.args)+")"}}class we extends v{declares=["base","openBracket","index","closeBracket"];base;openBracket;index;closeBracket;nodeType="ArrayAccess";constructor(e,t,i,s){super(),this.base=e,this.openBracket=t,this.index=i,this.closeBracket=s,this.range=h.of([e,t,i,s])}isWellFormed(){return this.base.isWellFormed()&&a.isValidToken(this.openBracket)&&this.index.isWellFormed()&&a.isValidToken(this.closeBracket)}toHumanReadableString(){return a.toHumanReadableString(this.base)+"["+a.toHumanReadableString(this.index)+"]"}}class Z extends ie{declares=["keyword","callee","openParen","args","closeParen"];keyword;nodeType="NewExpr";constructor(e,t,i,s,n){super(t,i,s,n),this.keyword=e,this.range.begin=e.range.begin}isWellFormed(){return a.isValidToken(this.keyword)&&this.callee.isWellFormed()&&a.isValidToken(this.openParen)&&this.args.isWellFormed()&&a.isValidToken(this.closeParen)}toHumanReadableString(){return"new "+a.toHumanReadableString(this.callee)+"("+a.toHumanReadableString(this.args)+")"}}class Ft extends v{declares=["values","comma"];values;comma;nodeType="Args";constructor(e,t){super(),this.values=e,this.comma=t,this.range=h.of(e)}isWellFormed(){return this.values.every(e=>e.isWellFormed())}toHumanReadableString(){return this.values.map(e=>a.toHumanReadableString(e)).join(", ")}}class J extends v{declares=["params","arrow","body"];params;arrow;body;nodeType="Lambda";constructor(e,t,i){super(),this.params=e,this.arrow=t,this.body=i,this.range=h.of(e,i||t)}isWellFormed(){return this.params.isWellFormed()&&a.isValidToken(this.arrow)&&this.body.isWellFormed()}toHumanReadableString(){let e="((";return this.params&&(e+=a.toHumanReadableString(this.params)),e+=") => ",e+=a.toHumanReadableString(this.body)+")",e}}class ve extends v{declares=["openParen","expr","closeParen"];openParen;expr;closeParen;nodeType="ExprGroup";constructor(e,t,i){super(),this.expr=t,this.openParen=e,this.closeParen=i,this.range=h.of(e,i||t)}isWellFormed(){return a.isValidToken(this.openParen)&&this.expr.isWellFormed()&&a.isValidToken(this.closeParen)}toHumanReadableString(){return"("+a.toHumanReadableString(this.expr)+")"}}class Dt{globalScope=new Wt(this);constructor(){}toplevel(){return this.globalScope}fullRange(){return y.Instance.getFullRange()}getContainingNodeAt(e){let t=this.getScopeAt(e);return t.kind==="function"&&t.func.body?.body||null}getScopeAt(e){return this.recursiveGetScopeAt(this.globalScope,e)||this.globalScope}recursiveGetScopeAt(e,t){if(e.range.contains(t)){for(const i of e.children){const s=this.recursiveGetScopeAt(i,t);if(s)return s.isVirtual()?s.parent:s}return e}return null}}class Nt{decl;loc;scope;scopeKind;constructor(e,t){this.decl=e,this.loc=e.range,this.scope=t,this.scopeKind=t.kind}}class ae{manager;range;children=[];parent;kind;declarations=new Map;constructor(e){this.parent=e,e&&(this.manager=e.manager,e.children.push(this))}isVirtual(){return this.kind==="block"&&!!this.parent&&this.parent.kind!=="block"}newBlockScope(){return new _t(this)}newFuncScope(){return new Vt(this)}pop(){return this.parent?this.parent:this}declare(e,t){if(this.isVirtual()){this.parent.declare(e,t);return}this.declarations.set(e,new Nt(t,this))}resolve(e){let t=this;for(;t;){if(t.exists(e))return t.declarations.get(e)||null;t=t.parent}return null}exists(e){return this.declarations.has(e)}clear(){this.declarations.clear(),this.children=[]}}class Wt extends ae{kind="global";constructor(e){super(null),this.manager=e,this.range=e.fullRange()}}class Vt extends ae{kind="function";func}class _t extends ae{kind="block";block}class jt{input;scope;beginOffsets=[];constructor(e,t){this.scope=e,this.input=t}get offset(){return this.input.seek().range.begin}parseBlock(){let e=[];for(this.scope=this.scope.newBlockScope();!this.input.isEmpty();){const i=this.input.seek();if(i.type===o.EOF||i.type===o.RBrace)break;e.push(this.parseStmt()),this.input.seek()?.type===o.Punctuation&&this.input.seek()?.value===";"&&this.input.consume()}let t=new pe(e);return this.scope.range=h.of(t),this.scope.block=t,this.scope=this.scope.pop(),t}eat(e){let t=this.input.seek();return t&&t.type===e?(this.input.consume(),t):null}reportErrorAfter(e,t,i){return new I(t," ",i,h.around(e.range.end))}reportErrorAt(e,t,i){return new I(t,e.value,i,e.range)}reportErrorAtRange(e,t,i){return new I(t,"",i,e.range.clone())}closeScope(e){return e.body?(this.scope.range=h.of(e.body),this.scope.func=e,this.scope=this.scope.pop(),e):(this.scope=this.scope.pop(),e)}closeScopeAndDeclare(e){let t=this.closeScope(e);return e.isWellFormed()&&e.name&&this.scope.declare(e.name.value,e),t}parseBody(){if(this.scope=this.scope.newFuncScope(),this.input.seek()?.type!==o.LBRACE){let s=[new $(null,this.parseExpr())];return new K(null,new pe(s),null)}let e=this.eat(o.LBRACE),t=this.parseBlock(),i=this.eat(o.RBrace);return i?new K(e,t,i):new K(e,t,this.reportErrorAt(this.input.seekPrevious(),o.SyntaxError,"'}' expected"))}parseStmt(){let e=this.input.seek();if(e.type==o.Keyword){if(e.value==="let"||e.value==="const"||e.value==="var")return this.parseDeclStmt();if(e.value==="function")return this.parseFuncDecl();if(e.value==="return")return this.parseReturnStmt()}return this.parseExpr()}parseReturnStmt(){let e=this.eat(o.Keyword);return this.input.seek()?.type===o.Punctuation&&this.input.seek()?.value===";"||this.input.seek()?.type===o.EOF||this.input.seek()?.type===o.RBrace||this.input.seekIncludeSpecial()?.type===o.EOL?new $(e,null):new $(e,this.parseExpr())}parseDeclStmt(){let e=this.eat(o.Keyword),t=this.eat(o.Identifier);if(!t)return new G(e,this.reportErrorAfter(e,o.SyntaxError,"Expected identifier"));let i;if(this.input.seek()?.type===o.Equals){let s=this.eat(o.Equals);i=new G(e,t,s,this.parseExpr_L0())}else i=new G(e,t);return this.scope.declare(t.value,i),i}parseFuncDecl(e=!1){let t=this.eat(o.Keyword),i=this.eat(o.Identifier);if(!i&&!e)return new W(t,this.reportErrorAfter(t,o.SyntaxError,"Function name expected"),null,null,null,null);let s=this.eat(o.LPAREN);if(!s)return new W(t,i,this.reportErrorAfter(i||t,o.SyntaxError,"'(' expected"),null,null,null);let n=this.parseParams(),l=this.eat(o.RPAREN);if(!l)return new W(t,i,s,n,this.reportErrorAfter(this.input.seekPrevious(),o.SyntaxError,"')' expected"),null);let c=this.parseBody();return this.closeScopeAndDeclare(new W(t,i,s,n,l,c))}parseParams(){let e=[],t=[];for(;!this.input.isEmpty()&&this.input.seek().type!=o.RPAREN&&this.input.seek().type!=o.EOF;)if(e.push(this.parseParam()),this.input.seek()?.type===o.Punctuation&&this.input.seek()?.value===",")t.push(this.eat(o.Punctuation));else if(this.input.seek()?.type!==o.RPAREN)t.push(this.reportErrorAfter(this.input.seekPrevious(),o.SyntaxError,"Expected ',' or ')'"));else break;return new N(e,t)}parseParam(){let e=null;this.input.seek()?.type===o.Punctuation&&this.input.seek()?.value==="..."&&(e=this.eat(o.Punctuation));let t=this.eat(o.Identifier);if(t)if(this.input.seek()?.type===o.Equals){if(e)return new S(t,e,this.reportErrorAt(this.input.consume(),o.SyntaxError,"Default value cannot be used with rest parameters"));let i=this.eat(o.Equals),s=this.parseExpr_L0();return new S(t,null,i,s)}else return new S(t,e);else return new S(this.reportErrorAfter(this.input.seekPrevious(),o.SyntaxError,"Parameter name expected"),e)}parseExpr(){let e=[this.parseExpr_L0()],t=[];for(;this.input.seek()?.type===o.Punctuation&&this.input.seek()?.value===",";)t.push(this.eat(o.Punctuation)),e.push(this.parseExpr_L0());return e.length===1?e[0]:new At(e,t)}parseExpr_L0(){let e=this.input.seek();if(!e)return new v(this.reportErrorAfter(this.input.seekPrevious(),o.SyntaxError,"Expression expected"));if(e.type===o.Punctuation&&e.value==="..."||e.type===o.Keyword&&e.value==="yield"){let i=this.input.consume(),s=this.parseExpr_L1();return new Q(i,s)}if(this.input.seek()?.type===o.Identifier&&this.input.seekN(1)?.type===o.Arrow){let i=this.eat(o.Identifier),s=this.eat(o.Arrow),n=this.parseBody();return this.closeScope(new J(new N([new S(i,null)]),s,n))}else if(this.input.seek()?.type===o.LPAREN&&this.input.seekN(1)?.type===o.RPAREN&&this.input.seekN(2)?.type===o.Arrow){this.eat(o.LPAREN),this.eat(o.RPAREN);let i=this.eat(o.Arrow),s=this.parseBody();return this.closeScope(new J(new N([],[]),i,s))}let t=this.parseExpr_L1();if(t.nodeType===b.ExprGroup&&this.input.seek()?.type===o.Arrow){let i,s;if(t.expr.nodeType===b.ExprCommaExpr){let u=t.expr;i=u.values,s=u.commas}else i=[t.expr],s=[];let n=this.eat(o.Arrow),l=this.parseBody(),c=[];for(let u=0;u<i.length;u++){let g=i[u];if(g.nodeType===b.UnaryExpr&&g.operator.value==="..."){let w=g.operator,k=g.operand;k.nodeType!==b.Identifier?c.push(new S(this.reportErrorAfter(w,o.SyntaxError,"Expected identifier"),w)):c.push(new S(k.token,w))}else g.nodeType===b.AssignExpr?c.push(new S(g.left.token,null,g.operator,g.right)):g.nodeType!==b.Identifier?c.push(new S(this.reportErrorAfter(s[u],o.SyntaxError,"Expected identifier"),null)):c.push(new S(g.token,null))}return this.closeScope(new J(new N(c,s),n,l))}if(this.input.seek()?.type===o.Punctuation&&this.input.seek()?.value==="?"){let i=this.eat(o.Punctuation),s=this.parseExpr_L0();if(this.input.seek()?.type!==o.Punctuation||this.input.seek()?.value!==":")return new me(t,i,s,this.reportErrorAfter(this.input.seekPrevious(),o.SyntaxError,"Expected ':' for ternary operator"),null);let n=this.eat(o.Punctuation),l=this.parseExpr_L0();return new me(t,i,s,n,l)}if(this.input.seek()?.type===o.EqualOp||this.input.seek()?.type===o.Equals){let i=this.input.consume();return new It(t,i,this.parseExpr())}return t}parseExpr_L1(){let e=this.parseExpr_L2(),t=this.input.seek();if(t?.type!==o.Operator)return e;if(t?.value==="??"||t?.value==="||"){let i=this.eat(o.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else if(t?.value==="&&"){let i=this.eat(o.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else if(t?.value==="|"){let i=this.eat(o.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else if(t?.value==="^"){let i=this.eat(o.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else if(t?.value==="&"){let i=this.eat(o.Operator),s=this.parseExpr_L2();return new A(e,i,s)}else return e}parseExpr_L2(){let e=this.parseExpr_L3(),t=this.input.seek();for(;t?.type===o.CompareOp||t?.type===o.Keyword;){if(t.type===o.Keyword&&t.value!=="in"&&t.value!=="instanceof")return e;e=new A(e,this.input.consume(),this.parseExpr_L3()),t=this.input.seek()}return e}parseExpr_L3(e=0){let t=this.parseExpr_L4();for(;this.input.seek()?.type===o.Operator;){let i=this.input.consume();if(V.getPrecedence(i.value)<e)break;let s=this.parseExpr_L3(V.isRightAssociative(i.value)?e:e+1);t=new A(t,i,s)}return t}parseExpr_L4(){let e=this.input.seek();if(e?.type===o.Keyword&&e.value==="new"){this.eat(o.Keyword);let i=this.parseExpr_L5();if(this.input.seek()?.type===o.LPAREN){let s=this.eat(o.LPAREN),n=this.parseArgs(),l=this.eat(o.RPAREN);return l?new Z(e,i,s,n,l):new Z(e,i,s,n,this.reportErrorAfter(this.input.seekPrevious(),o.SyntaxError,"')' expected"))}return new Z(e,i,null,null,null)}else if(e?.type===o.UnOperator||e?.type===o.Keyword&&["typeof","void","delete","await"].includes(e.value)||e?.type===o.Operator&&(e.value==="+"||e.value==="-")){let i=this.input.consume(),s=this.parseExpr_L4();return new Q(i,s)}else if(e?.type===o.IncrDecrOp){let i=this.input.consume(),s=this.parseExpr_L5();return new Q(i,s)}let t=this.parseExpr_L5();for(;;)if(this.input.seek()?.type===o.LPAREN){let i=this.eat(o.LPAREN),s=this.parseArgs(),n=this.eat(o.RPAREN);if(!n)return new ie(t,i,s,this.reportErrorAfter(this.input.seekPrevious(),o.SyntaxError,"')' expected"));t=this.parseExpr_L5(new ie(t,i,s,n))}else if(this.input.seek()?.type===o.LBRACKET){let i=this.eat(o.LBRACKET),s=this.parseExpr(),n=this.eat(o.RBRACKET);if(!n)return new we(t,i,s,this.reportErrorAt(this.input.seekPrevious(),o.SyntaxError,"']' expected"));t=this.parseExpr_L5(new we(t,i,s,n))}else return t}parseExpr_L5(e){for(e=e||this.parseExpr_L6();this.input.seek()?.type===o.Punctuation&&this.input.seek()?.value===".";){let t=this.eat(o.Punctuation);e=new Ht(e,t,this.parseExpr_L6())}return e}parseExpr_L6(){let e=this.input.seek();if(e?.type===o.Keyword)return e.value!=="this"&&e.value!=="super"&&e.value!=="null"&&e.value!=="true"&&e.value!=="false"?new v(this.reportErrorAt(this.input.consume(),o.SyntaxError,"Unexpected keyword")):new Ot(this.input.consume());if(e?.type===o.LPAREN){let t=this.eat(o.LPAREN),i=this.parseExpr(),s=this.eat(o.RPAREN);return s?new ve(t,i,s):new ve(t,i,this.reportErrorAt(this.input.seekPrevious(),o.SyntaxError,"')' expected"))}else{if(e?.type===o.Identifier)return new te(this.input.consume());if(e?.type===o.Number)return new Mt(this.input.consume());if(e?.type===o.String)return new Pt(this.input.consume());if(e?.type===o.LBRACKET){let t=this.eat(o.LBRACKET),i=[],s=[];for(;!this.input.isEmpty()&&this.input.seek()?.type!==o.RBRACKET&&(i.push(this.parseExpr_L0()),this.input.seek()?.type===o.Punctuation&&this.input.seek()?.value===",");)s.push(this.eat(o.Punctuation));let n=this.eat(o.RBRACKET);return n?new ge(t,i,n,s):new ge(t,i,this.reportErrorAt(this.input.seekPrevious(),o.SyntaxError,"']' expected"),s)}else{if(e?.type===o.LBRACE)return this.parseObjectLiteral();if(!e)return new v(this.reportErrorAfter(this.input.seekPrevious(),o.SyntaxError,"Unexpected EOF"))}}return new v(this.reportErrorAt(this.input.consume(),o.SyntaxError,"Unexpected token"))}parseArgs(){let e=[],t=[];for(;!this.input.isEmpty()&&this.input.seek()?.type!==o.RPAREN&&(e.push(this.parseExpr_L0()),this.input.seek()?.type===o.Punctuation&&this.input.seek()?.value===",");)t.push(this.eat(o.Punctuation));return new Ft(e,t)}parseObjectLiteral(){let e=this.eat(o.LBRACE),t=[],i=[];for(;!this.input.isEmpty()&&this.input.seek()?.type!==o.RBrace;){let n=this.input.seek();if(n.type!==o.Identifier&&n.type!==o.String)t.push(new H(this.reportErrorAt(this.input.consume(),o.SyntaxError,"Expected identifier or string as key"),null,null));else if(n.type===o.Identifier&&(n.value==="get"||n.value==="set")&&this.input.seekN(1)?.type===o.Identifier){let l=this.input.consume(),c=this.parseFuncDecl();c.keyword=l,t.push(new Bt(c))}else if(n.type===o.Identifier||n.type===o.String){let l=this.input.consume(),c=this.input.seek();if(c?.type!==o.Punctuation||c.value!==":")l.type===o.String?t.push(new H(n,this.reportErrorAfter(n,o.SyntaxError,"':' expected"),null)):t.push(new H(l,null,new te(l)));else{this.eat(o.Punctuation);let u=this.parseExpr_L0();t.push(new H(l,c,u))}}if(this.input.seek()?.type!==o.Punctuation||this.input.seek()?.value!==",")break;i.push(this.eat(o.Punctuation))}let s=this.eat(o.RBrace);return s?new fe(e,t,s,i):new fe(e,t,this.reportErrorAfter(this.input.seekPrevious(),o.SyntaxError,"'}' expected"),i)}}class Se{createScopeManager(){return new Dt}parse(e,t){return new jt(e,t).parseBlock()}}class he{static visitAll(e,t){let i=[];for(let s of e)i=i.concat(he.recursiveVisit(s,t));return i}static recursiveVisit(e,t){if(e instanceof p){let i=t[`visitToken${e.type}`];if(i){let s=i(e);if(s!=null)return[s]}}else{let i=[],s=t[`visitNode${e.nodeType}`];if(s){let n=s(e);n!=null&&i.push(n)}for(let n of e.getNodeContent())i=i.concat(this.recursiveVisit(n,t));return i}return[]}}class ye extends ne{name="inline-link";className="js-link";range;element;target;listeners=[];constructor(e,t){super(),this.content=e.value,this.range=e.range.cloneNotTracked(),this.target=t}onDestroy(e){this.listeners.forEach(t=>e.removeVisualEventListener(t))}onceRendered(){let e=this.view;e.addEventListener("click",()=>{y.with(e.getEditor(),()=>{if(E.isCtrlPressed){let i=e.getEditor().getCaretModel();i.removeAll(),i.getPrimary().moveToOffset(this.target),this.onLeave()}})}),e.addEventListener("mousemove",()=>y.with(e.getEditor(),()=>this.onEnter())),e.addEventListener("mouseleave",()=>this.onLeave());let t=new class extends j{onKeyUp(i,s){s.key==="Control"&&e.removeClass("js-link-hover")}};e.getEditor().addVisualEventListener(t),this.listeners.push(t)}onEnter(){E.isCtrlPressed?this.element?.classList.add("js-link-hover"):this.element?.classList.remove("js-link-hover")}onLeave(){this.element?.classList.remove("js-link-hover")}}class Yt extends qe{name="js-lang-plugin";description="JavaScript Language Plugin for Editor";constructor(){super()}onRegistered(e,t){t.registerFileTypeAssociation("js",()=>new q,()=>new Rt,()=>new Se),e.addLangEventListener("js",this)}onSrLoaded(e,t,i,s){he.visitAll(i,new class{visitNodeIdentifier(n){let l=n,c=e.getOpenedDocument().getSrTree().getScopingModel().getScopeAt(l.range.begin);if(!c)return;let u=c.resolve(l.token.value);if(!u){e.addErrorAt(l.range,"js-identifier-not-found",l.token.value,`Undefined identifier: ${l.token.value}`);return}if(u.decl.nodeType===b.FuncDeclStmt){e.getComponentManager().add(new f(l.token,"js-function-name"));let g=u.decl;e.getComponentManager().add(new ye(l.token,g.name.range.begin))}if(u.decl.nodeType===b.DeclStmt){e.getComponentManager().add(new f(l.token,"js-variable-name"));let g=u.decl;e.getComponentManager().add(new ye(l.token,g.name.range.begin))}}visitTokenSyntaxError(n){let l=n;e.addErrorAt(l.range,"js-syntax-error",l.value,l.msg)}})}}const ce=new oe;ce.registerPlugin(new Yt);ce.attach(document.querySelector(".editor-c"));window.editor=ce;window.EditorInstance=y;window.js=new q;window.JSParsingUtils=a;window.TextRange=h;window.HighlightedToken=f;window.p=r=>console.log(a.toHumanReadableString(parser.parse(null,js.asTokenStream(r))));window.parser=new Se;
